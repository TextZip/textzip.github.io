<!DOCTYPE html>
<html lang="en-US" 
>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Hands On with AVR - 01 Port Manipulation" />
<meta name="author" content="Jai Krishna" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Port Manipulation refers to the technique of directly working with the underlying registers of the ATmega chip(in this context) instead of relying on predefined Arduino functions. This is primarily done to reduce your code’s memory footprint and make it run faster." />
<meta property="og:description" content="Port Manipulation refers to the technique of directly working with the underlying registers of the ATmega chip(in this context) instead of relying on predefined Arduino functions. This is primarily done to reduce your code’s memory footprint and make it run faster." />
<link rel="canonical" href="https://textzip.github.io/posts/AVR-Diaries-01-Port-Manipulation/" />
<meta property="og:url" content="https://textzip.github.io/posts/AVR-Diaries-01-Port-Manipulation/" />
<meta property="og:site_name" content="Jai Krishna" />
<meta property="og:image" content="https://textzip.github.io/assets/img/PortManipulation/arduino_label.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-04T19:13:20+05:30" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://textzip.github.io/assets/img/PortManipulation/arduino_label.png" />
<meta property="twitter:title" content="Hands On with AVR - 01 Port Manipulation" />
<meta name="twitter:site" content="@twitter_username" />
<meta name="twitter:creator" content="@Jai Krishna" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jai Krishna"},"dateModified":"2022-01-18T20:03:40+05:30","datePublished":"2020-05-04T19:13:20+05:30","description":"Port Manipulation refers to the technique of directly working with the underlying registers of the ATmega chip(in this context) instead of relying on predefined Arduino functions. This is primarily done to reduce your code’s memory footprint and make it run faster.","headline":"Hands On with AVR - 01 Port Manipulation","image":"https://textzip.github.io/assets/img/PortManipulation/arduino_label.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://textzip.github.io/posts/AVR-Diaries-01-Port-Manipulation/"},"url":"https://textzip.github.io/posts/AVR-Diaries-01-Port-Manipulation/"}</script>
 <title>Hands On with AVR - 01 Port Manipulation | Jai Krishna
 </title>
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Jai Krishna">
<meta name="application-name" content="Jai Krishna">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
<link rel="dns-prefetch" href="https://fonts.gstatic.com">
  <link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials">
  <link rel="dns-prefetch" href="https://www.google-analytics.com">
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script defer
    src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>
  <script async
    src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script>
<script defer src="/assets/js/dist/post.min.js"></script>
  <script defer src="/app.js"></script>
<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=G-KGYYX7MFB2"
></script>
<script>
  /* global dataLayer */
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());
  gtag("config", "G-KGYYX7MFB2");
</script>
 <body data-spy="scroll" data-target="#toc">
<div id="sidebar" class="d-flex flex-column align-items-end">
 <div class="profile-wrapper text-center">
   <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        <img src="/assets/img/profile.jpg" alt="avatar" onerror="this.style.display='none'">
      </a>
   </div>
   <div class="site-title mt-3">
      <a href="/">Jai Krishna</a>
   </div>
   <div class="site-subtitle font-italic">Robotics | Electronics | Design</div>
 </div>
 <ul class="w-100">
   <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
   <li class="nav-item">
      <a href="/projects/" class="nav-link">
        <i class="fa-fw fas fa-microchip ml-xl-3 mr-xl-3 unloaded"></i>
        <span>PROJECTS</span>
      </a>
   <li class="nav-item">
      <a href="/resources/" class="nav-link">
        <i class="fa-fw fas fa-chalkboard-teacher ml-xl-3 mr-xl-3 unloaded"></i>
        <span>RESOURCES</span>
      </a>
   <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        <span>CATEGORIES</span>
      </a>
   <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ARCHIVES</span>
      </a>
   <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ABOUT | CONTACT</span>
      </a>
   <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-chalkboard-teacher ml-xl-3 mr-xl-3 unloaded"></i>
        <span>TAGS</span>
      </a>
 </ul>
 <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center">
      <a href="https://github.com/TextZip" aria-label="github"
        class="order-3"
        target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      <a href="
          javascript:location.href = 'mailto:' + ['textzip','gmail.com'].join('@')" aria-label="email"
        class="order-4"
        >
        <i class="fas fa-envelope"></i>
      </a>
      <a href="https://www.linkedin.com/in/jai-krishna-bandi" aria-label="linkedin"
        class="order-5"
        target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
        <span class="icon-border order-2"></span>
      <span id="mode-toggle-wrapper" class="order-1">
<i class="mode-toggle fas fa-adjust"></i>
<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }
    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }
      var self = this;
      /* always follow the system prefers */
      this.sysDarkPrefers.addListener(function() {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }
          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }
          self.clearMode();
        }
        self.updateMermaid();
      });
    } /* constructor() */
    setDark() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }
    setLight() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }
    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_KEY);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }
    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }
    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }
    get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; }
    get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; }
    get hasMode() { return this.mode != null; }
    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }
    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer) ) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }
    updateMermaid() {
      if (typeof mermaid !== "undefined") {
        let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default");
        let config = { theme: expectedTheme };
        /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */
        $(".mermaid").each(function() {
          let svgCode = $(this).prev().children().html();
          $(this).removeAttr("data-processed");
          $(this).html(svgCode);
        });
        mermaid.initialize(config);
        mermaid.init(undefined, ".mermaid");
      }
    }
    flipMode() {
      if (this.hasMode) {
        if (this.isSysDarkPrefer) {
          if (this.isLightMode) {
            this.clearMode();
          } else {
            this.setLight();
          }
        } else {
          if (this.isDarkMode) {
            this.clearMode();
          } else {
            this.setDark();
          }
        }
      } else {
        if (this.isSysDarkPrefer) {
          this.setLight();
        } else {
          this.setDark();
        }
      }
      this.updateMermaid();
    } /* flipMode() */
  } /* ModeToggle */
  let toggle = new ModeToggle();
  $(".mode-toggle").click(function() {
    toggle.flipMode();
  });
</script>
      </span>
 </div>
</div>
<div id="topbar-wrapper" class="row justify-content-center topbar-down">
 <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">
        <span>
          <a href="/">
            Posts
          </a>
        </span>
          <span>Hands On with AVR - 01 Port Manipulation</span>
    </span>
    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>
   <div id="topbar-title">
      Post
   </div>
    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
 </div>
</div>
   <div id="main-wrapper">
     <div id="main">
<div class="row">
 <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">
   <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
     <h1 data-toc-skip>Hands On with AVR - 01 Port Manipulation</h1>
     <div class="post-meta text-muted d-flex flex-column">
       <div>
          <span class="semi-bold">
            Bandi Jai Krishna
          </span>
<em class="timeago"
    data-ts="1588599800"
      data-toggle="tooltip" data-placement="bottom" 
      title="Mon, May  4, 2020,  7:13 PM +0530"
    >
  2020-05-04
</em>
       </div>
       <div>
          <span>
<em class="timeago lastmod"
    data-ts="1642516420"
      data-toggle="tooltip" data-placement="bottom" 
      title="Tue, Jan 18, 2022,  8:03 PM +0530"
    >
  2022-01-18
</em>
          </span>
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1624 words">9 min</span>
       </div>
     </div>
     <div class="post-content">
       <p>Port Manipulation refers to the technique of directly working with the underlying registers of the ATmega chip(in this context) instead of relying on predefined Arduino functions. This is primarily done to reduce your code’s memory footprint and make it run faster.</p>
<p>To understand how the memory and speed get affected by using the Arduino functions, lets take an example,</p>
<p>Here is the code for the arduino <strong>pinMode()</strong> function:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">pinMode</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">pin</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
        <span class="kt">uint8_t</span> <span class="n">bit</span> <span class="o">=</span> <span class="n">digitalPinToBitMask</span><span class="p">(</span><span class="n">pin</span><span class="p">);</span>
        <span class="kt">uint8_t</span> <span class="n">port</span> <span class="o">=</span> <span class="n">digitalPinToPort</span><span class="p">(</span><span class="n">pin</span><span class="p">);</span>
        <span class="k">volatile</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">reg</span><span class="p">,</span> <span class="o">*</span><span class="n">out</span><span class="p">;</span>
 
        <span class="k">if</span> <span class="p">(</span><span class="n">port</span> <span class="o">==</span> <span class="n">NOT_A_PIN</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
 
        <span class="c1">// JWS: can I let the optimizer do this?</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="n">portModeRegister</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">portOutputRegister</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
 
        <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">INPUT</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">uint8_t</span> <span class="n">oldSREG</span> <span class="o">=</span> <span class="n">SREG</span><span class="p">;</span>
                <span class="n">cli</span><span class="p">();</span>
                <span class="o">*</span><span class="n">reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">bit</span><span class="p">;</span>
                <span class="o">*</span><span class="n">out</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">bit</span><span class="p">;</span>
                <span class="n">SREG</span> <span class="o">=</span> <span class="n">oldSREG</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">INPUT_PULLUP</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">uint8_t</span> <span class="n">oldSREG</span> <span class="o">=</span> <span class="n">SREG</span><span class="p">;</span>
                <span class="n">cli</span><span class="p">();</span>
                <span class="o">*</span><span class="n">reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">bit</span><span class="p">;</span>
                <span class="o">*</span><span class="n">out</span> <span class="o">|=</span> <span class="n">bit</span><span class="p">;</span>
                <span class="n">SREG</span> <span class="o">=</span> <span class="n">oldSREG</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="kt">uint8_t</span> <span class="n">oldSREG</span> <span class="o">=</span> <span class="n">SREG</span><span class="p">;</span>
                <span class="n">cli</span><span class="p">();</span>
                <span class="o">*</span><span class="n">reg</span> <span class="o">|=</span> <span class="n">bit</span><span class="p">;</span>
                <span class="n">SREG</span> <span class="o">=</span> <span class="n">oldSREG</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div>
<p>As you can see, although we tend to treat it as a single line of code, internally, it contains many lines of code, and multiple function calls to get its job done. This article will learn how to write into registers directly and further understand that pinMode and other stock functions internally do the same.</p>
<p>Before starting port manipulation, you need to get yourself familiar with bit math and bit manipulation; here is a quick intro to it.</p>
<h2 id="bit-manipulation">Bit Manipulation</h2>
<p>Manipulating the internal registers of the ATmega chip involves flipping bits in 8-bit (usually) arrays, as the ATmega328p is 8-bit in nature, so our primary learning objective would be to learn how to flip, read, write to bit/bits without affecting or disturbing the other bits in a given array.</p>
<h3 id="setting-a-bit-high">Setting a bit HIGH</h3>
<p>Let us learn how to set a bit HIGH/1 in a given array. For this example let us consider the following.
You are given an 8-bit array and you do not know the states of any of the pins, you are further required to turn the 4th bit in the array to 1. (irrespective of its current state)</p>
<p>Given array :: <strong>xxxx yxxx</strong>
Create an array :: <strong>0000 1000</strong> (can be done using <strong>1«3</strong>)
Perform OR operation on both the arrays.
Resulting array :: <strong>xxxx 1xxx</strong></p>
<p>As we can see, irrespective of the initial state of the 4th bit, it is now set to 1 for sure. Also, notice how the other 7 bits remain unaffected by this operation regardless of their initial state.</p>
<p>To put this up as a syntax, assuming the given array is called <strong>EXP</strong>. The above logic can be written as</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">EXP</span> <span class="o">=</span> <span class="n">EXP</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">3</span><span class="p">);</span> <span class="c1">//One way to write it </span>
<span class="n">EXP</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">3</span><span class="p">);</span> <span class="c1">//A more compact way of writing the same expression.</span>
</pre></table></code></div></div>
<h3 id="setting-a-bit-low">Setting a bit LOW</h3>
<p>Setting a bit LOW/0 is pretty much similar to setting a bit HIGH/1 in terms of our approach. Let us consider an example to understand better. You are given an 8-bit array, and the initial states of all the pins are unknown. We have to set the 4th bit in the given array to 0. (irrespective of its current state)</p>
<p>Given array :: <strong>xxxx yxxx</strong>
Create an array :: <strong>0000 1000</strong> (can be done using <strong>1«3</strong>)
Invert the array :: <strong>1111 0111</strong> (can be done using <strong>~(1«3)</strong> )
Perform AND operation on the inverted array and the given array.
Resulting array :: <strong>xxxx 0xxx</strong></p>
<p>Just like we saw in the previous example of setting a bit HIGH, only the 4th bit is set to 0, and all the other pins are left unaffected irrespective of their initial states. To put this in syntax, assuming the given array is called <strong>EXP</strong>. The above logic can be written as</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">EXP</span> <span class="o">=</span> <span class="n">EXP</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">3</span><span class="p">);</span> <span class="c1">//One way to write it </span>
<span class="n">EXP</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">3</span><span class="p">);</span> <span class="c1">//A more compact way of writing the same expression.</span>
</pre></table></code></div></div>
<h3 id="reading-the-state-of-a-bit">Reading the state of a bit</h3>
<p>Just like setting the setting a bit HIGH and LOW, we might at times want to read the current state of the bit. Let us consider the following example. You are given an 8-bit array, and the initial states of the bits are unknown. We have to find the current state of the 4th bit in the given array.</p>
<p>Given array :: <strong>xxxx yxxx</strong>
Left shift the given array :: <strong>000x xxxy</strong> (such that y is at the corner, can be done using <strong>EXP»3</strong> )
Perform AND operation with the shifted array and 0000 0001.
Resulting array :: <strong>0000 000y</strong></p>
<p>The above logic can be written as,</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">RESULT</span> <span class="o">=</span> <span class="n">EXP</span><span class="o">&gt;&gt;</span><span class="mi">3</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>
</pre></table></code></div></div>
<h3 id="flipping-the-state-of-a-bit">Flipping the state of a bit</h3>
<p>Sometimes especially in loops, we might just need to flip the state of a bit over and over again without bothering about its initial or final states. For example let us consider an 8-bit array where we are supposed to flip the state of the 4th bit.</p>
<p>Given array :: <strong>xxxx yxxx</strong>
Create an array :: <strong>0000 1000</strong> (can be created using <strong>1«3</strong> )
Perform XOR Operation on the two arrays.
Resulting array :: <strong>xxxx (~y)xxx</strong></p>
<p>The above logic can be written as,</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">EXP</span> <span class="o">=</span> <span class="n">EXP</span> <span class="o">^</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">3</span><span class="p">);</span> <span class="c1">//One way to write it</span>
<span class="n">EXP</span> <span class="o">^=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">3</span><span class="p">);</span> <span class="c1">//A more compact way of writing the same expression</span>
</pre></table></code></div></div>
<h2 id="port-registers">Port Registers</h2>
<p>Port registers allow for faster manipulation of the I/O pins, the predefined functions for GPIO in Arduino, while easy to use, conceal a lot of the features and functionality the ATmega can offer.</p>
<p>The ATmega 328p has three ports, refer to the yellow tag markers in the below picture for the labels.</p>
<p>Port B – Digital pins 8 to 13
Port C – Analog Pins
Port D – Digital pins 0 to 7</p>
<p><img src="/assets/img/PortManipulation/arduino_label.png" alt="Image1" class="shadow" /></p>
<p>What are ports ?</p>
<p>Ports are collections of Pins sharing a set of common SFR’s. (vaguely speaking, a group of pins is called a port)</p>
<p>To intuitively understand the need for port registers, let’s quickly list all the attributes a GPIO pin can have in general.</p>
<ul>
 <li><strong>INPUT / OUTPUT / INPUT_PULLUP</strong> – PinMode()
 <li><strong>HIGH / LOW</strong> – DigitalWrite()
 <li><strong>“Value the pin stores”</strong> – DigitalRead()
</ul>
<p>Each of these attributes have one register associated for them, they are defined as the following.</p>
<ul>
 <li><strong>Data Direction Register (DDR)</strong> – INPUT / OUTPUT
 <li><strong>Data Register (PORT)</strong> – HIGH / LOW
 <li><strong>Input Pin Register (PIN)</strong> – “value the pin stores”
</ul>
<p><em>NOTE: AnalogRead() and AnalogWrite() have separate registers and will be discussed in ADC and timers posts.</em></p>
<p>The <strong>DDR</strong> register, determines whether the pin is an <strong>INPUT</strong> or <strong>OUTPUT</strong>. The <strong>PORT</strong> register controls whether the pin is <strong>HIGH</strong> or <strong>LOW</strong>, and the <strong>PIN</strong> register reads the state of <strong>INPUT</strong> pins set to input with <strong>pinMode()</strong>. <strong>DDR</strong> and <strong>PORT</strong> registers may be both written to, and read. <strong>PIN</strong> registers correspond to the state of inputs and may only be read.</p>
<p>Each bit of these registers corresponds to a single pin; e.g. the low bit of <strong>DDRB</strong>, <strong>PORTB</strong>, and <strong>PINB</strong> refers to pin <strong>PB0</strong> (digital pin 8).</p>
<p>Let us look at some examples on how to use these registers.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">// LED Blinking Code </span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">(){</span>
  <span class="n">DDRB</span> <span class="o">|=</span> <span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">6</span><span class="p">;</span> <span class="c1">//pinMode(13,OUTPUT);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">loop</span><span class="p">(){</span>
  <span class="n">PORTB</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">5</span><span class="p">);</span> <span class="c1">//digitalWrite(13,HIGH);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
  <span class="n">PORTB</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">5</span><span class="p">);</span> <span class="c1">//digitalWrite(13,LOW);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>  
</pre></table></code></div></div>
<p>Note that the entire code block in void loop can be replaced by the following code:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">loop</span><span class="p">(){</span>
  <span class="n">PORTB</span> <span class="o">^=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">5</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div>
<p>Note that the code <code class="language-plaintext highlighter-rouge">DDRB |= 00101110;</code> is the equivalent of setting the pins 8, 12 as inputs and 9,10,11,13 as outputs, this would have taken 6 pinMode function calls to achieve, similarly other tasks like setting multiple pins HIGH or LOW or reading the sates of the pins can be achieved in fewer lines of code.</p>
<p>PIN register reads the data from all the pins at once, and can be used like the other registers shown in the above examples. More examples will be taken up in the subsequent tutorials.</p>
<p>As a concluding example let us take up the following code.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre><td class="rouge-code"><pre><span class="cm">/*
Objective : The void loop is busy with a process
shown as delay(5000). You need the AVR to perform some smaller 
and more important tasks once in a while.
*/</span>
<span class="cm">/*
volatile int state = LOW; 
const int led = 12;
const int button = 2;
void setup(){
  pinMode(led, OUTPUT);
  pinMode(button,INPUT_PULLUP);
  attachInterrupt(digitalPinToInterrupt(button),blinker,FALLING);
}
void blinker(){
   
  state = state == HIGH ? LOW : HIGH;
  digitalWrite(led,state);
}
void loop()
{
 delay(5000);
}
*/</span>
 
<span class="cm">/*--------------------------------------------------*/</span>
 
<span class="n">ISR</span><span class="p">(</span><span class="n">INT0_vect</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">PORTB</span> <span class="o">^=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
   
  <span class="c1">//Enable D12 as OUTPUT</span>
  <span class="n">DDRB</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
  <span class="c1">//Enable D2 as INPUT_PULLUP</span>
  <span class="n">DDRD</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">PORTD</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
 
  <span class="c1">//Enable Falling edge</span>
  <span class="n">EICRA</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">EICRA</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ISC01</span><span class="p">);</span>
  <span class="c1">//Enable Mask</span>
  <span class="n">EIMSK</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">EIMSK</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">INT0</span><span class="p">);</span>
  <span class="c1">//Enable global interrupts</span>
  <span class="n">sei</span><span class="p">();</span>
 
  <span class="c1">// put your setup code here, to run once:</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
  <span class="c1">// put your main code here, to run repeatedly:</span>
<span class="p">}</span>
</pre></table></code></div></div>
<p>The schematic for the above code is attached below. While the code might contain a few new topics like interrupts, it is well documented and understandable. We will dive into the interrupts part in the following tutorial.</p>
<p><img src="/assets/img/PortManipulation/breadboard.png" alt="Image2" class="shadow" /></p>
<h2 id="external-resouces">External Resouces</h2>
<iframe width="640" height="385" src="https://youtube.com/embed/6q1yEb_ukw8" frameborder="0" allowfullscreen=""></iframe>
<iframe width="640" height="385" src="https://youtube.com/embed/UhTRrjYXqPU" frameborder="0" allowfullscreen=""></iframe>
     </div>
     <div class="post-tail-wrapper text-muted">
       <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
            <a href='/categories/resources/'>Resources</a>,
            <a href='/categories/avr-dairies/'>AVR Dairies</a>
       </div>
       <div class="post-tags">
          <i class="fa fa-tags fa-fw mr-1"></i>
          <a href="/tags/atmega328p/"
            class="post-tag no-text-decoration" >atmega328p</a>
          <a href="/tags/port/"
            class="post-tag no-text-decoration" >port</a>
          <a href="/tags/pin/"
            class="post-tag no-text-decoration" >pin</a>
          <a href="/tags/register/"
            class="post-tag no-text-decoration" >register</a>
          <a href="/tags/bit-math/"
            class="post-tag no-text-decoration" >bit math</a>
         </div>
       <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
         <div class="license-wrapper">
            This post is licensed under
            <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
            by the author.
         </div>
<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
        <a href="https://twitter.com/intent/tweet?text=Hands On with AVR - 01 Port Manipulation - Jai Krishna&url=https://textzip.github.io/posts/AVR-Diaries-01-Port-Manipulation/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
        <a href="https://www.facebook.com/sharer/sharer.php?title=Hands On with AVR - 01 Port Manipulation - Jai Krishna&u=https://textzip.github.io/posts/AVR-Diaries-01-Port-Manipulation/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
        <a href="https://telegram.me/share?text=Hands On with AVR - 01 Port Manipulation - Jai Krishna&url=https://textzip.github.io/posts/AVR-Diaries-01-Port-Manipulation/" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    <i class="fa-fw fas fa-link small" onclick="copyLink()"
        data-toggle="tooltip" data-placement="top" title="Copy link"></i>
  </span>
</div>
       </div>
     </div>
   </div>
 </div>
<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">
 <div class="access">
   <div id="access-lastmod" class="post">
      <span>Recent Update</span>
     <ul class="post-content pl-0 pb-1 ml-1 mt-2">
       <li><a href="/posts/Loco-DRL/">Proprioceptive Locomotion in Unstructured Environments</a>
       <li><a href="/posts/FTG-DRL/">Policy Modulated Trajectory Generation for Quadrupeds</a>
       <li><a href="/posts/NST-DRL/">Neural Style Transfer for Locomotion</a>
       <li><a href="/posts/LIDAR-DRL/">Locomotion with Weighted Belief in Exteroception</a>
       <li><a href="/posts/BiMan-DRL/">Bi-Manual Loco-Manipulation in Quadrupeds for Opening Doors</a>
     </ul>
   </div>
   <div id="access-tags">
      <span>Trending Tags</span>
     <div class="d-flex flex-wrap mt-3 mb-1 mr-3">
        <a class="post-tag" href="/tags/atmega328p/">atmega328p</a>
        <a class="post-tag" href="/tags/imu/">imu</a>
        <a class="post-tag" href="/tags/game/">game</a>
        <a class="post-tag" href="/tags/reinforcement-learning/">reinforcement learning</a>
        <a class="post-tag" href="/tags/bellman/">bellman</a>
        <a class="post-tag" href="/tags/mdp/">mdp</a>
        <a class="post-tag" href="/tags/optimal-value/">optimal value</a>
        <a class="post-tag" href="/tags/touch/">touch</a>
        <a class="post-tag" href="/tags/quadruped/">quadruped</a>
        <a class="post-tag" href="/tags/ros/">ros</a>
     </div>
   </div>
 </div>
    <script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>
   <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
      <span class="pl-3 pt-2 mb-2">Contents</span>
     <nav id="toc" data-toggle="toc"></nav>
   </div>
</div>
</div>
<div class="row">
 <div class="col-12 col-lg-11 col-xl-8">
   <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
 <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
   <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
   <div class="card-deck mb-4">
     <div class="card">
        <a href="/posts/AVR-Diaries-03-Timers/">
         <div class="card-body">
<em class="timeago small"
    data-ts="1588605500"
    >
  2020-05-04
</em>
           <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hands On with AVR - 03 Timers</h3>
           <div class="text-muted small">
             <p>
                The ATmega328p has two 8 bit timers and one 16 bit timer. Each timer has multiple modes of working. We will be covering all the timers together in the tutorial, one mode at a time.
Timers &amp; Pr...
             </p>
           </div>
         </div>
        </a>
     </div>
     <div class="card">
        <a href="/posts/AVR-Diaries-02-Interrupts/">
         <div class="card-body">
<em class="timeago small"
    data-ts="1589367200"
    >
  2020-05-13
</em>
           <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hands On with AVR - 02 Interrupts</h3>
           <div class="text-muted small">
             <p>
                Most processors have interrupts. Interrupts let you respond to “external/internal” events while doing something else.
This article uses concepts that have been covered in the previous post “AVR Di...
             </p>
           </div>
         </div>
        </a>
     </div>
     <div class="card">
        <a href="/posts/Gaming-Wheel/">
         <div class="card-body">
<em class="timeago small"
    data-ts="1545486200"
    >
  2018-12-22
</em>
           <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Gaming Wheel</h3>
           <div class="text-muted small">
             <p>
A cheap and affordable gaming wheel based on the Atmega-328p,
MPU6050 and capacitive touch sensors for an immersive gaming
experience.
Hardware
  Arduino Uno
  ADXL345 (or any IMU or tilt senso...
             </p>
           </div>
         </div>
        </a>
     </div>
   </div>
 </div>
<div class="post-navigation d-flex justify-content-between">
  <a href="/posts/Underwater-Rover/" class="btn btn-outline-primary"
    prompt="Older">
   <p>Underwater Rover</p>
  </a>
  <a href="/posts/AVR-Diaries-03-Timers/" class="btn btn-outline-primary"
    prompt="Newer">
   <p>Hands On with AVR - 03 Timers</p>
  </a>
</div>
    <script src="https://utteranc.es/client.js"
        repo="TextZip/textzip.github.io"
        issue-term="title"
        theme="dark-blue"
        crossorigin="anonymous"
        async>
    </script>
   </div>
 </div>
</div>
<footer class="d-flex w-100 justify-content-center">
 <div class="d-flex justify-content-between align-items-center">
   <div class="footer-left">
     <p class="mb-0">
        © 2025
        <a href="https://github.com/TextZip">Bandi Jai Krishna</a>.
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
     </p>
   </div>
   <div class="footer-right">
     <p class="mb-0">
        Powered by
        <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
        with
        <a href="https://github.com/cotes2020/jekyll-theme-chirpy"
          target="_blank" rel="noopener">Chirpy</a>
        theme.
     </p>
   </div>
 </div>
</footer>
     </div>
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
 <div class="col-12 col-sm-11 post-content">
   <div id="search-hints">
     <h4 class="text-muted mb-4">Trending Tags</h4>
        <a class="post-tag" href="/tags/atmega328p/">atmega328p</a>
        <a class="post-tag" href="/tags/imu/">imu</a>
        <a class="post-tag" href="/tags/game/">game</a>
        <a class="post-tag" href="/tags/reinforcement-learning/">reinforcement learning</a>
        <a class="post-tag" href="/tags/bellman/">bellman</a>
        <a class="post-tag" href="/tags/mdp/">mdp</a>
        <a class="post-tag" href="/tags/optimal-value/">optimal value</a>
        <a class="post-tag" href="/tags/touch/">touch</a>
        <a class="post-tag" href="/tags/quadruped/">quadruped</a>
        <a class="post-tag" href="/tags/ros/">ros</a>
   </div>
   <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
 </div>
</div>
   </div>
   <div id="mask"></div>
    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>
<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script>
<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="https://textzip.github.io{url}">{title}</a> <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags} </div><p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }
    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>
  
