<!DOCTYPE html>
<html lang="en-US" 
>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Hands On with AVR - 02 Interrupts" />
<meta name="author" content="Jai Krishna" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Most processors have interrupts. Interrupts let you respond to “external/internal” events while doing something else." />
<meta property="og:description" content="Most processors have interrupts. Interrupts let you respond to “external/internal” events while doing something else." />
<link rel="canonical" href="https://textzip.github.io/posts/AVR-Diaries-02-Interrupts/" />
<meta property="og:url" content="https://textzip.github.io/posts/AVR-Diaries-02-Interrupts/" />
<meta property="og:site_name" content="Jai Krishna" />
<meta property="og:image" content="https://textzip.github.io/assets/img/PortManipulation/arduino_label.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-13T16:23:20+05:30" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://textzip.github.io/assets/img/PortManipulation/arduino_label.png" />
<meta property="twitter:title" content="Hands On with AVR - 02 Interrupts" />
<meta name="twitter:site" content="@twitter_username" />
<meta name="twitter:creator" content="@Jai Krishna" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jai Krishna"},"dateModified":"2022-01-18T20:14:23+05:30","datePublished":"2020-05-13T16:23:20+05:30","description":"Most processors have interrupts. Interrupts let you respond to “external/internal” events while doing something else.","headline":"Hands On with AVR - 02 Interrupts","image":"https://textzip.github.io/assets/img/PortManipulation/arduino_label.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://textzip.github.io/posts/AVR-Diaries-02-Interrupts/"},"url":"https://textzip.github.io/posts/AVR-Diaries-02-Interrupts/"}</script>
 <title>Hands On with AVR - 02 Interrupts | Jai Krishna
 </title>
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Jai Krishna">
<meta name="application-name" content="Jai Krishna">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
<link rel="dns-prefetch" href="https://fonts.gstatic.com">
  <link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials">
  <link rel="dns-prefetch" href="https://www.google-analytics.com">
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script defer
    src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>
  <script async
    src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script>
<script defer src="/assets/js/dist/post.min.js"></script>
  <script defer src="/app.js"></script>
<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=G-KGYYX7MFB2"
></script>
<script>
  /* global dataLayer */
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());
  gtag("config", "G-KGYYX7MFB2");
</script>
 <body data-spy="scroll" data-target="#toc">
<div id="sidebar" class="d-flex flex-column align-items-end">
 <div class="profile-wrapper text-center">
   <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        <img src="/assets/img/profile.jpg" alt="avatar" onerror="this.style.display='none'">
      </a>
   </div>
   <div class="site-title mt-3">
      <a href="/">Jai Krishna</a>
   </div>
   <div class="site-subtitle font-italic">Robotics | Electronics | Design</div>
 </div>
 <ul class="w-100">
   <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
   <li class="nav-item">
      <a href="/projects/" class="nav-link">
        <i class="fa-fw fas fa-microchip ml-xl-3 mr-xl-3 unloaded"></i>
        <span>PROJECTS</span>
      </a>
   <li class="nav-item">
      <a href="/resources/" class="nav-link">
        <i class="fa-fw fas fa-chalkboard-teacher ml-xl-3 mr-xl-3 unloaded"></i>
        <span>RESOURCES</span>
      </a>
   <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        <span>CATEGORIES</span>
      </a>
   <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ARCHIVES</span>
      </a>
   <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ABOUT | CONTACT</span>
      </a>
   <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-chalkboard-teacher ml-xl-3 mr-xl-3 unloaded"></i>
        <span>TAGS</span>
      </a>
 </ul>
 <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center">
      <a href="https://github.com/TextZip" aria-label="github"
        class="order-3"
        target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      <a href="
          javascript:location.href = 'mailto:' + ['textzip','gmail.com'].join('@')" aria-label="email"
        class="order-4"
        >
        <i class="fas fa-envelope"></i>
      </a>
      <a href="https://www.linkedin.com/in/jai-krishna-bandi" aria-label="linkedin"
        class="order-5"
        target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
        <span class="icon-border order-2"></span>
      <span id="mode-toggle-wrapper" class="order-1">
<i class="mode-toggle fas fa-adjust"></i>
<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }
    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }
      var self = this;
      /* always follow the system prefers */
      this.sysDarkPrefers.addListener(function() {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }
          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }
          self.clearMode();
        }
        self.updateMermaid();
      });
    } /* constructor() */
    setDark() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }
    setLight() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }
    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_KEY);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }
    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }
    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }
    get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; }
    get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; }
    get hasMode() { return this.mode != null; }
    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }
    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer) ) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }
    updateMermaid() {
      if (typeof mermaid !== "undefined") {
        let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default");
        let config = { theme: expectedTheme };
        /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */
        $(".mermaid").each(function() {
          let svgCode = $(this).prev().children().html();
          $(this).removeAttr("data-processed");
          $(this).html(svgCode);
        });
        mermaid.initialize(config);
        mermaid.init(undefined, ".mermaid");
      }
    }
    flipMode() {
      if (this.hasMode) {
        if (this.isSysDarkPrefer) {
          if (this.isLightMode) {
            this.clearMode();
          } else {
            this.setLight();
          }
        } else {
          if (this.isDarkMode) {
            this.clearMode();
          } else {
            this.setDark();
          }
        }
      } else {
        if (this.isSysDarkPrefer) {
          this.setLight();
        } else {
          this.setDark();
        }
      }
      this.updateMermaid();
    } /* flipMode() */
  } /* ModeToggle */
  let toggle = new ModeToggle();
  $(".mode-toggle").click(function() {
    toggle.flipMode();
  });
</script>
      </span>
 </div>
</div>
<div id="topbar-wrapper" class="row justify-content-center topbar-down">
 <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">
        <span>
          <a href="/">
            Posts
          </a>
        </span>
          <span>Hands On with AVR - 02 Interrupts</span>
    </span>
    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>
   <div id="topbar-title">
      Post
   </div>
    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
 </div>
</div>
   <div id="main-wrapper">
     <div id="main">
<div class="row">
 <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">
   <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
     <h1 data-toc-skip>Hands On with AVR - 02 Interrupts</h1>
     <div class="post-meta text-muted d-flex flex-column">
       <div>
          <span class="semi-bold">
            Bandi Jai Krishna
          </span>
<em class="timeago"
    data-ts="1589367200"
      data-toggle="tooltip" data-placement="bottom" 
      title="Wed, May 13, 2020,  4:23 PM +0530"
    >
  2020-05-13
</em>
       </div>
       <div>
          <span>
<em class="timeago lastmod"
    data-ts="1642517063"
      data-toggle="tooltip" data-placement="bottom" 
      title="Tue, Jan 18, 2022,  8:14 PM +0530"
    >
  2022-01-18
</em>
          </span>
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2243 words">12 min</span>
       </div>
     </div>
     <div class="post-content">
       <p>Most processors have interrupts. Interrupts let you respond to “external/internal” events while doing something else.</p>
<p>This article uses concepts that have been covered in the previous post “AVR Diaries 01 - Port Manipulation”, if your not familiar with port manipulation, it is highly recommended that you go through the earlier parts before continuing any further.</p>
<h2 id="understanding-the-need-for-interrupts">Understanding the need for interrupts</h2>
<p>Before we dive headfirst into interrupts and all the superpowers they grant to us, let’s take a step back and see why we need interrupts. Let’s take a simple sketch where an LED on pin 13 is turned on every time we press a button connected to pin 9. The LED turns off right after we release the button.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kt">int</span> <span class="n">prev_state</span> <span class="o">=</span> <span class="n">LOW</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">LED_state</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">current_state</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">INPUT_PULLUP</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">current_state</span> <span class="o">=</span> <span class="n">digitalRead</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span>
  <span class="n">current_state</span> <span class="o">=</span> <span class="o">!</span><span class="n">current_state</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">current_state</span> <span class="o">==</span><span class="n">HIGH</span> <span class="o">&amp;&amp;</span> <span class="n">prev_state</span><span class="o">==</span><span class="n">LOW</span><span class="p">){</span>
    <span class="n">LED_state</span> <span class="o">=</span> <span class="n">HIGH</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="nf">if</span><span class="p">(</span><span class="n">current_state</span> <span class="o">==</span><span class="n">LOW</span> <span class="o">&amp;&amp;</span> <span class="n">prev_state</span><span class="o">==</span><span class="n">HIGH</span><span class="p">){</span>
    <span class="n">LED_state</span> <span class="o">=</span> <span class="n">LOW</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">prev_state</span><span class="o">=</span><span class="n">current_state</span><span class="p">;</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="n">LED_state</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div>
<p>This program on its own isn’t that great and doesn’t seem to be much useful, let us consider that the above sketch is part of a bigger program where an math intensive task runs in the void loop for about 2 second along with the above program.
The resulting code would look like this</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="kt">int</span> <span class="n">prev_state</span> <span class="o">=</span> <span class="n">LOW</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">LED_state</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">current_state</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">INPUT_PULLUP</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">current_state</span> <span class="o">=</span> <span class="n">digitalRead</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span>
  <span class="n">current_state</span> <span class="o">=</span> <span class="o">!</span><span class="n">current_state</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">current_state</span> <span class="o">==</span><span class="n">HIGH</span> <span class="o">&amp;&amp;</span> <span class="n">prev_state</span><span class="o">==</span><span class="n">LOW</span><span class="p">){</span>
    <span class="n">LED_state</span> <span class="o">=</span> <span class="n">HIGH</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="nf">if</span><span class="p">(</span><span class="n">current_state</span> <span class="o">==</span><span class="n">LOW</span> <span class="o">&amp;&amp;</span> <span class="n">prev_state</span><span class="o">==</span><span class="n">HIGH</span><span class="p">){</span>
    <span class="n">LED_state</span> <span class="o">=</span> <span class="n">LOW</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">prev_state</span><span class="o">=</span><span class="n">current_state</span><span class="p">;</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="n">LED_state</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div>
<p>You can immediately notice that the push button is no longer responsive, and some of the inputs are not registered and processed. The Arduino is busy doing some other heavy math tasks for 5 seconds every loop cycle. Therefore the Arduino will not record any inputs during these 5 seconds.</p>
<p>When we start writing bigger and more complex projects in arduino, reaction time to events is very crucial and interrupts are the arduinos way of dealing with time critical events.</p>
<h2 id="interrupts--their-types">Interrupts &amp; their types</h2>
<p>A very technical and broad definition would be that</p>
<blockquote>
 <p>An Interrupt is a signal emitted by hardware or software when a process or an event needs immediate attention. It alerts the processor to a high priority process requiring interruption of the current working process.</p>
</blockquote>
<p>A more simple and understandable definion would be</p>
<blockquote>
 <p>An Interrupt’s job is to make sure that the processor responds quickly to important events. When a certain signal is detected, an Interrupt (as the name suggests) interrupts whatever the processor is doing, and executes some code designed to react to whatever external stimulus is being fed to the Arduino. Once that code has wrapped up, the processor goes back to whatever it was originally doing as if nothing happened.</p>
</blockquote>
<p>Arudino Uno has a wide varitiy of interrupts each specifically designed for a paticular task.
We will be looking at three of them:</p>
<ol>
 <li>External Interrupts
 <li>Pin Change Interrupts
 <li>Timer Interrupts (covered in the next post)
</ol>
<h2 id="external-interrupts">External Interrupts</h2>
<p>These are the most commonly used interrupts, like the name suggests they are responsible for triggering an interrupt based on changes in signals originating outside the arduino, like button presses for example. Note that not all pins are capable of this and Digital Pins 2 and 3 are the only two pins that can detect external interrupts in the Arduino uno.</p>
<p>External interrupts can be setup via two different methods we will now be looking at both the methods.</p>
<h3 id="method-1">Method 1</h3>
<p>We will be using the external interrupt on digital pin 2, to toggel an LED on pin 13 everytime we press we button. The trigger mode is set to rising.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="k">volatile</span> <span class="kt">int</span> <span class="n">state</span> <span class="o">=</span> <span class="n">LOW</span><span class="p">;</span> 
<span class="k">const</span> <span class="kt">int</span> <span class="n">led</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">button</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">(){</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">led</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">button</span><span class="p">,</span><span class="n">INPUT_PULLUP</span><span class="p">);</span>
  <span class="n">attachInterrupt</span><span class="p">(</span><span class="n">digitalPinToInterrupt</span><span class="p">(</span><span class="n">button</span><span class="p">),</span><span class="n">blinker</span><span class="p">,</span><span class="n">FALLING</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">blinker</span><span class="p">(){</span>
  <span class="n">state</span> <span class="o">=</span> <span class="n">state</span> <span class="o">==</span> <span class="n">HIGH</span> <span class="o">?</span> <span class="n">LOW</span> <span class="o">:</span> <span class="n">HIGH</span><span class="p">;</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">led</span><span class="p">,</span><span class="n">state</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
 <span class="n">delay</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span><span class="c1">//some random process to show that interrupts do interrupt.</span>
<span class="p">}</span>

</pre></table></code></div></div>
<ul>
 <li>General syntax for <code class="language-plaintext highlighter-rouge">attachInterrupt()</code> is <code class="language-plaintext highlighter-rouge">attachInterrupt(digitalPinToInterrupt(pin), ISR, mode)</code>
   <ul>
     <li>The first parameter to <code class="language-plaintext highlighter-rouge">attachInterrupt()</code> is an interrupt number. Normally you should use <code class="language-plaintext highlighter-rouge">digitalPinToInterrupt(pin)</code> to translate the actual digital pin to the specific interrupt number. For example, if you connect to pin 3, use <code class="language-plaintext highlighter-rouge">digitalPinToInterrupt(3)</code> as the first parameter to <code class="language-plaintext highlighter-rouge">attachInterrupt()</code>.
     <li>the ISR to call when the interrupt occurs; this function must take no parameters and return nothing. This function is sometimes referred to as an interrupt service routine.
     <li>mode: defines when the interrupt should be triggered. Four constants are predefined as valid values.
       <ul>
         <li>
           <p><strong>LOW</strong> to trigger the interrupt whenever the pin is low,</p>
         <li>
           <p><strong>CHANGE</strong> to trigger the interrupt whenever the pin changes value</p>
         <li>
           <p><strong>RISING</strong> to trigger when the pin goes from low to high,</p>
         <li>
           <p><strong>FALLING</strong> for when the pin goes from high to low.</p>
       </ul>
   </ul>
</ul>
<h3 id="method-2">Method 2</h3>
<p>We will be working on the same example that was demonstrated in method 1, but we will now be using port manipulation instead of pre-defined functions.</p>
<p>The three main registers we will be working with are <strong>EICRA, EIMSK, EIFR</strong>.</p>
<ul>
 <li><strong>EICRA (External Interrupt Control Register A)</strong>
This register contains 4 bits two each for one external interrupt pin. They are used to select the trigger mode for the external interrupt. For our current example we are only conserned with the external interrupt on digital pin 2 which is refered to as <strong>INT0</strong>.
 <li><strong>EIMSK (External Interrupt Mask Register)</strong>
This register has two bits one for each of the external interrupts, they are called <strong>External Interrupt Request Enable</strong> bits, when set to high along with the Global Interrupts being enabled in the <strong>SREG</strong>. The external interrupt for that paticular pin will be enabled. Activity on the pin will cause an interrupt request even if INT1 is configured as an output. The corresponding interrupt of External Interrupt Request is executed from the Interrupt Vector.
 <li><strong>EIFR (External Interrupt Flag Register)</strong>
This register contains two bits one each for the external interrupts, When an edge or logic change on the INTx pin triggers an interrupt request, INTFx becomes set (one). If the Ibit in SREG and the INTx bit in EIMSK are set (one), the MCU will jump to the corresponding Interrupt Vector.The flag is cleared when the interrupt routine is executed. Alternatively, the flag can be cleared by writing a logical one to it. This flag is always cleared when INTx is configured as a level interrupt.
</ul>
<div class="language-c++ highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="n">ISR</span><span class="p">(</span><span class="n">INT0_vect</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">PORTB</span> <span class="o">^=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span> <span class="c1">// Toggle the state of the LED</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">cli</span><span class="p">();</span>
  <span class="c1">//Enable D13 as OUTPUT</span>
  <span class="n">DDRB</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>
  <span class="c1">//Enable D2 as INPUT_PULLUP</span>
  <span class="n">DDRD</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">PORTD</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

  <span class="c1">//Enable Falling edge</span>
  <span class="n">EICRA</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">EICRA</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ISC01</span><span class="p">);</span>
  <span class="c1">//Enable Mask</span>
  <span class="n">EIMSK</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">EIMSK</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">INT0</span><span class="p">);</span>
  <span class="c1">//Enable global interrupts</span>
  <span class="n">sei</span><span class="p">();</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span> <span class="c1">//some random process to show that interrupts do interrupt.</span>
<span class="p">}</span>
</pre></table></code></div></div>
<p><code class="language-plaintext highlighter-rouge">sei()</code> - Enable Global Interrupts by setting the I-bit in the SREG register to one.
<code class="language-plaintext highlighter-rouge">cli()</code> - Disable Global Interrupts by setting the I-Bit in the SREG register to zero.</p>
<h2 id="pin-change-interrupts">Pin Change Interrupts</h2>
<p>The Pin Change Interrupt is triggered when the state of any of the pins with the PCINT enabled is changed. We primarly deal with three registers <strong>PCICR, PCIFR, PCMSKx</strong>.</p>
<ul>
 <li><strong>PCICR (Pin Change Interrupt Control Register)</strong>
When the <strong>PCIEx</strong> bit is set (one) and the <strong>I-bit</strong> in the <strong>Status Register (SREG)</strong> is set (one), pin change interrupt for that paticular port is enabled. Any change on any enabled <strong>PCINT</strong> pins will cause an interrupt. The corresponding interrupt of Pin Change Interrupt Request is executed from the <strong>PCIx Interrupt Vector</strong>. <strong>PCINT</strong> pins are enabled individually by the <strong>PCMSKx</strong> Register
 <li><strong>PCIFR (Pin Change Interrupt Flag Register)</strong>
When a logic change on any <strong>PCINT</strong> pins triggers an interrupt request, <strong>PCIFx</strong> becomes set (one). If the <strong>I-bit</strong> in <strong>SREG</strong> and the <strong>PCIEx</strong> bit in <strong>PCICR</strong> are set (one), the MCU will jump to the corresponding Interrupt Vector. The flag is cleared when the interrupt routine is executed. Alternatively, the flag can be cleared by writing a logical one to it.
 <li><strong>PCMSKx (Pin Change Mask Register x)</strong>
Each <strong>PCINT-bit</strong> selects whether pin change interrupt is enabled on the corresponding I/O pin. If <strong>PCINT</strong> is set and the <strong>PCIEx</strong> bit in <strong>PCICR</strong> is set, pin change interrupt is enabled on the corresponding I/O pin. If <strong>PCINT</strong> is cleared, pin change interrupt on the  corresponding I/O pin is disabled.
</ul>
<blockquote>
 <p>NOTE: Pin Change Interrupts do not have mode selection, therefore any change in the logic level will trigger an interrupt.</p>
</blockquote>
<p>Let us now look at a sketch that we earlier worked with using external interrupts, we will be using pin change interrupts on PORT B and C with masks enabled only for pins A1 and D9 to toggle and LED connected to digital pin 13. Given that a single press of the push button will raise the pin change interrupts twice as its senstive to any change and not just rising or falling, we also will be using a small polling based counter to toggle the LED like before.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="k">volatile</span> <span class="kt">int</span> <span class="n">counter_1</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="k">volatile</span> <span class="kt">int</span> <span class="n">counter_2</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">ISR</span> <span class="p">(</span><span class="n">PCINT0_vect</span><span class="p">)</span> <span class="c1">//ISR for Digital Pin 9</span>
 <span class="p">{</span>
  <span class="n">counter_1</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">counter_1</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span><span class="mi">0</span><span class="p">){</span> 
    <span class="n">PORTB</span> <span class="o">^=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">5</span><span class="p">);</span> 
  <span class="p">}</span>
  
 <span class="p">}</span>
<span class="n">ISR</span> <span class="p">(</span><span class="n">PCINT1_vect</span><span class="p">)</span> <span class="c1">// ISR for A1 Pin</span>
 <span class="p">{</span>
  <span class="n">counter_2</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">counter_2</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span><span class="mi">0</span><span class="p">){</span>
    <span class="n">PORTB</span> <span class="o">^=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">5</span><span class="p">);</span> 
  <span class="p">}</span>
  
 <span class="p">}</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">cli</span><span class="p">();</span> <span class="c1">// Disable Global Interrupts</span>
  <span class="n">PCICR</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
  <span class="n">PCICR</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">PCIE0</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">PCIE1</span><span class="p">);</span> <span class="c1">// Enable Pin Change Interrupts for PORT B and C</span>
  <span class="n">PCMSK0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// Reset Masks</span>
  <span class="n">PCMSK1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// Reset Masks</span>
  <span class="n">PCMSK0</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">PCINT1</span><span class="p">);</span> <span class="c1">// Enable Pin Change mask for A1 Pin</span>
  <span class="n">PCMSK1</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">PCINT9</span><span class="p">);</span> <span class="c1">//// Enable Pin Change mask for Digital Pin 9</span>
  <span class="n">sei</span><span class="p">();</span> <span class="c1">// Enable Global Interrupts</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span> 
  <span class="n">pinMode</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span><span class="n">INPUT_PULLUP</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="n">INPUT_PULLUP</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span> <span class="c1">//some random process to show that interrupts do interrupt.</span>
<span class="p">}</span> 
</pre></table></code></div></div>
<p>We can also add an millis based cooldown time once a trigger has been called to take care of debouncing and multiple interrupts being called for a single press. Further, we can even save the states of the pins and compare them to the states of the pins as soon as the interrupt has been called to find out which pin caused the interrupt to be triggered. These two applications are left for you to try them on your own.</p>
<h2 id="input-servie-routine">Input Servie Routine</h2>
<p>ISRs are special kinds of functions that have some unique limitations most other functions do not have. An ISR cannot have any parameters, and they shouldn’t return anything.</p>
<p>Generally, an ISR should be as short and fast as possible. If your sketch uses multiple ISRs, only one can run at a time, other interrupts will be executed after the current one finishes in an order that depends on the priority they have. millis() relies on interrupts to count, so it will never increment inside an ISR. Since delay() requires interrupts to work, it will not work if called inside an ISR. micros() works initially but will start behaving erratically after 1-2 ms. delayMicroseconds() does not use any counter, so it will work as normal.</p>
<p>Typically global variables are used to pass data between an ISR and the main program. To make sure variables shared between an ISR and the main program are updated correctly, declare them as volatile.</p>
<p><strong>Quick Facts about ISR</strong></p>
<ul>
 <li>ISR’s have a priority order incase two or more of them are called at once.
 <li>Once inside an ISR the global interrupts are turned off, to prevent nested interrupt calls and once the ISR has finished its service the global interrupts are turned back on. You can manually turn on global interrupts inside an ISR for some crazy results.
 <li>Do not use Serial, Delay and other heavy functions inside an ISR.
 <li>External interrupts, pin-change interrupts, and the watchdog timer interrupt, can also be used to wake the processor up. This can be very handy, as in sleep mode the processor can be configured to use a lot less power (eg. around 10 microamps). A rising, falling, or low-level interrupt can be used to wake up a gadget (eg. if you press a button on it), or a “watchdog timer” interrupt might wake it up periodically (eg. to check the time or temperature). Pin-change interrupts could be used to wake the processor if a key is pressed on a keypad, or similar. The processor can also be awoken by a timer interrupt (eg. a timer reaching a certain value, or overflowing) and certain other events, such as an incoming I2C message.
 <li>You must have seen me using cli() to disable interrupts quite often in the examples covered above, this is to make sure an interrupt isn’t triggered while I am writing data to the registers.
</ul>
<h2 id="external-resources">External Resources</h2>
<iframe width="640" height="385" src="https://youtube.com/embed/J61_PKyWjxU" frameborder="0" allowfullscreen=""></iframe>
<p><a href="http://gammon.com.au/interrupts">Nick Gammon’s notes on Interrupts</a></p>
     </div>
     <div class="post-tail-wrapper text-muted">
       <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
            <a href='/categories/resources/'>Resources</a>,
            <a href='/categories/avr-dairies/'>AVR Dairies</a>
       </div>
       <div class="post-tags">
          <i class="fa fa-tags fa-fw mr-1"></i>
          <a href="/tags/atmega328p/"
            class="post-tag no-text-decoration" >atmega328p</a>
          <a href="/tags/external-interrupts/"
            class="post-tag no-text-decoration" >external interrupts</a>
          <a href="/tags/pin-change-interrupts/"
            class="post-tag no-text-decoration" >pin change interrupts</a>
          <a href="/tags/isr/"
            class="post-tag no-text-decoration" >ISR</a>
         </div>
       <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
         <div class="license-wrapper">
            This post is licensed under
            <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
            by the author.
         </div>
<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
        <a href="https://twitter.com/intent/tweet?text=Hands On with AVR - 02 Interrupts - Jai Krishna&url=https://textzip.github.io/posts/AVR-Diaries-02-Interrupts/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
        <a href="https://www.facebook.com/sharer/sharer.php?title=Hands On with AVR - 02 Interrupts - Jai Krishna&u=https://textzip.github.io/posts/AVR-Diaries-02-Interrupts/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
        <a href="https://telegram.me/share?text=Hands On with AVR - 02 Interrupts - Jai Krishna&url=https://textzip.github.io/posts/AVR-Diaries-02-Interrupts/" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    <i class="fa-fw fas fa-link small" onclick="copyLink()"
        data-toggle="tooltip" data-placement="top" title="Copy link"></i>
  </span>
</div>
       </div>
     </div>
   </div>
 </div>
<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">
 <div class="access">
   <div id="access-lastmod" class="post">
      <span>Recent Update</span>
     <ul class="post-content pl-0 pb-1 ml-1 mt-2">
       <li><a href="/posts/Loco-DRL/">Proprioceptive Locomotion in Unstructured Environments</a>
       <li><a href="/posts/FTG-DRL/">Policy Modulated Trajectory Generation for Quadrupeds</a>
       <li><a href="/posts/NST-DRL/">Neural Style Transfer for Locomotion</a>
       <li><a href="/posts/LIDAR-DRL/">Locomotion with Weighted Belief in Exteroception</a>
       <li><a href="/posts/BiMan-DRL/">Bi-Manual Loco-Manipulation in Quadrupeds for Opening Doors</a>
     </ul>
   </div>
   <div id="access-tags">
      <span>Trending Tags</span>
     <div class="d-flex flex-wrap mt-3 mb-1 mr-3">
        <a class="post-tag" href="/tags/atmega328p/">atmega328p</a>
        <a class="post-tag" href="/tags/imu/">imu</a>
        <a class="post-tag" href="/tags/game/">game</a>
        <a class="post-tag" href="/tags/reinforcement-learning/">reinforcement learning</a>
        <a class="post-tag" href="/tags/bellman/">bellman</a>
        <a class="post-tag" href="/tags/mdp/">mdp</a>
        <a class="post-tag" href="/tags/optimal-value/">optimal value</a>
        <a class="post-tag" href="/tags/touch/">touch</a>
        <a class="post-tag" href="/tags/quadruped/">quadruped</a>
        <a class="post-tag" href="/tags/ros/">ros</a>
     </div>
   </div>
 </div>
    <script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>
   <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
      <span class="pl-3 pt-2 mb-2">Contents</span>
     <nav id="toc" data-toggle="toc"></nav>
   </div>
</div>
</div>
<div class="row">
 <div class="col-12 col-lg-11 col-xl-8">
   <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
 <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
   <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
   <div class="card-deck mb-4">
     <div class="card">
        <a href="/posts/AVR-Diaries-01-Port-Manipulation/">
         <div class="card-body">
<em class="timeago small"
    data-ts="1588599800"
    >
  2020-05-04
</em>
           <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hands On with AVR - 01 Port Manipulation</h3>
           <div class="text-muted small">
             <p>
                Port Manipulation refers to the technique of directly working with the underlying registers of the ATmega chip(in this context) instead of relying on predefined Arduino functions. This is primarily...
             </p>
           </div>
         </div>
        </a>
     </div>
     <div class="card">
        <a href="/posts/AVR-Diaries-03-Timers/">
         <div class="card-body">
<em class="timeago small"
    data-ts="1588605500"
    >
  2020-05-04
</em>
           <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hands On with AVR - 03 Timers</h3>
           <div class="text-muted small">
             <p>
                The ATmega328p has two 8 bit timers and one 16 bit timer. Each timer has multiple modes of working. We will be covering all the timers together in the tutorial, one mode at a time.
Timers &amp; Pr...
             </p>
           </div>
         </div>
        </a>
     </div>
     <div class="card">
        <a href="/posts/Gaming-Wheel/">
         <div class="card-body">
<em class="timeago small"
    data-ts="1545486200"
    >
  2018-12-22
</em>
           <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Gaming Wheel</h3>
           <div class="text-muted small">
             <p>
A cheap and affordable gaming wheel based on the Atmega-328p,
MPU6050 and capacitive touch sensors for an immersive gaming
experience.
Hardware
  Arduino Uno
  ADXL345 (or any IMU or tilt senso...
             </p>
           </div>
         </div>
        </a>
     </div>
   </div>
 </div>
<div class="post-navigation d-flex justify-content-between">
  <a href="/posts/Robotics-Theory-2D-Robotics/" class="btn btn-outline-primary"
    prompt="Older">
   <p>Robotics Theory - 2D Robotics</p>
  </a>
  <a href="/posts/Stair-Climbing/" class="btn btn-outline-primary"
    prompt="Newer">
   <p>Autonomous Stair Climbing Robot</p>
  </a>
</div>
    <script src="https://utteranc.es/client.js"
        repo="TextZip/textzip.github.io"
        issue-term="title"
        theme="dark-blue"
        crossorigin="anonymous"
        async>
    </script>
   </div>
 </div>
</div>
<footer class="d-flex w-100 justify-content-center">
 <div class="d-flex justify-content-between align-items-center">
   <div class="footer-left">
     <p class="mb-0">
        © 2025
        <a href="https://github.com/TextZip">Bandi Jai Krishna</a>.
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
     </p>
   </div>
   <div class="footer-right">
     <p class="mb-0">
        Powered by
        <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
        with
        <a href="https://github.com/cotes2020/jekyll-theme-chirpy"
          target="_blank" rel="noopener">Chirpy</a>
        theme.
     </p>
   </div>
 </div>
</footer>
     </div>
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
 <div class="col-12 col-sm-11 post-content">
   <div id="search-hints">
     <h4 class="text-muted mb-4">Trending Tags</h4>
        <a class="post-tag" href="/tags/atmega328p/">atmega328p</a>
        <a class="post-tag" href="/tags/imu/">imu</a>
        <a class="post-tag" href="/tags/game/">game</a>
        <a class="post-tag" href="/tags/reinforcement-learning/">reinforcement learning</a>
        <a class="post-tag" href="/tags/bellman/">bellman</a>
        <a class="post-tag" href="/tags/mdp/">mdp</a>
        <a class="post-tag" href="/tags/optimal-value/">optimal value</a>
        <a class="post-tag" href="/tags/touch/">touch</a>
        <a class="post-tag" href="/tags/quadruped/">quadruped</a>
        <a class="post-tag" href="/tags/ros/">ros</a>
   </div>
   <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
 </div>
</div>
   </div>
   <div id="mask"></div>
    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>
<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script>
<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="https://textzip.github.io{url}">{title}</a> <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags} </div><p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }
    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>
  
