<!DOCTYPE html>
<html lang="en-US" 
>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="TF101" />
<meta name="author" content="Jai Krishna" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Contents: Visulization of TF, Publishing, Broadcasting &amp; Listening to TF, Static Transform, Joint and Robot State Publishers." />
<meta property="og:description" content="Contents: Visulization of TF, Publishing, Broadcasting &amp; Listening to TF, Static Transform, Joint and Robot State Publishers." />
<link rel="canonical" href="https://textzip.github.io/posts/ROS-TF101/" />
<meta property="og:url" content="https://textzip.github.io/posts/ROS-TF101/" />
<meta property="og:site_name" content="Jai Krishna" />
<meta property="og:image" content="https://textzip.github.io/assets/img/Ros_logo.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-05-04T16:17:25+05:30" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://textzip.github.io/assets/img/Ros_logo.png" />
<meta property="twitter:title" content="TF101" />
<meta name="twitter:site" content="@twitter_username" />
<meta name="twitter:creator" content="@Jai Krishna" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jai Krishna"},"dateModified":"2022-01-18T16:36:00+05:30","datePublished":"2021-05-04T16:17:25+05:30","description":"Contents: Visulization of TF, Publishing, Broadcasting &amp; Listening to TF, Static Transform, Joint and Robot State Publishers.","headline":"TF101","image":"https://textzip.github.io/assets/img/Ros_logo.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://textzip.github.io/posts/ROS-TF101/"},"url":"https://textzip.github.io/posts/ROS-TF101/"}</script>
 <title>TF101 | Jai Krishna
 </title>
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Jai Krishna">
<meta name="application-name" content="Jai Krishna">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
<link rel="dns-prefetch" href="https://fonts.gstatic.com">
  <link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials">
  <link rel="dns-prefetch" href="https://www.google-analytics.com">
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script defer
    src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>
  <script async
    src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script>
<script defer src="/assets/js/dist/post.min.js"></script>
  <script>
  /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */
  MathJax = {
    tex: {
      inlineMath: [              /* start/end delimiter pairs for in-line math */
        ['$','$'],
        ['\\(','\\)']
      ],
      displayMath: [             /* start/end delimiter pairs for display math */
        ['$$', '$$'],
        ['\\[', '\\]']
      ]
    }
  };
  </script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
  </script>
  <script defer src="/app.js"></script>
<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=G-KGYYX7MFB2"
></script>
<script>
  /* global dataLayer */
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());
  gtag("config", "G-KGYYX7MFB2");
</script>
 <body data-spy="scroll" data-target="#toc">
<div id="sidebar" class="d-flex flex-column align-items-end">
 <div class="profile-wrapper text-center">
   <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        <img src="/assets/img/profile.jpg" alt="avatar" onerror="this.style.display='none'">
      </a>
   </div>
   <div class="site-title mt-3">
      <a href="/">Jai Krishna</a>
   </div>
   <div class="site-subtitle font-italic">Robotics | Electronics | Design</div>
 </div>
 <ul class="w-100">
   <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
   <li class="nav-item">
      <a href="/projects/" class="nav-link">
        <i class="fa-fw fas fa-microchip ml-xl-3 mr-xl-3 unloaded"></i>
        <span>PROJECTS</span>
      </a>
   <li class="nav-item">
      <a href="/resources/" class="nav-link">
        <i class="fa-fw fas fa-chalkboard-teacher ml-xl-3 mr-xl-3 unloaded"></i>
        <span>RESOURCES</span>
      </a>
   <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        <span>CATEGORIES</span>
      </a>
   <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ARCHIVES</span>
      </a>
   <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ABOUT | CONTACT</span>
      </a>
   <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-chalkboard-teacher ml-xl-3 mr-xl-3 unloaded"></i>
        <span>TAGS</span>
      </a>
 </ul>
 <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center">
      <a href="https://github.com/TextZip" aria-label="github"
        class="order-3"
        target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      <a href="
          javascript:location.href = 'mailto:' + ['textzip','gmail.com'].join('@')" aria-label="email"
        class="order-4"
        >
        <i class="fas fa-envelope"></i>
      </a>
      <a href="https://www.linkedin.com/in/jai-krishna-bandi" aria-label="linkedin"
        class="order-5"
        target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
        <span class="icon-border order-2"></span>
      <span id="mode-toggle-wrapper" class="order-1">
<i class="mode-toggle fas fa-adjust"></i>
<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }
    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }
      var self = this;
      /* always follow the system prefers */
      this.sysDarkPrefers.addListener(function() {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }
          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }
          self.clearMode();
        }
        self.updateMermaid();
      });
    } /* constructor() */
    setDark() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }
    setLight() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }
    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_KEY);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }
    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }
    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }
    get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; }
    get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; }
    get hasMode() { return this.mode != null; }
    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }
    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer) ) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }
    updateMermaid() {
      if (typeof mermaid !== "undefined") {
        let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default");
        let config = { theme: expectedTheme };
        /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */
        $(".mermaid").each(function() {
          let svgCode = $(this).prev().children().html();
          $(this).removeAttr("data-processed");
          $(this).html(svgCode);
        });
        mermaid.initialize(config);
        mermaid.init(undefined, ".mermaid");
      }
    }
    flipMode() {
      if (this.hasMode) {
        if (this.isSysDarkPrefer) {
          if (this.isLightMode) {
            this.clearMode();
          } else {
            this.setLight();
          }
        } else {
          if (this.isDarkMode) {
            this.clearMode();
          } else {
            this.setDark();
          }
        }
      } else {
        if (this.isSysDarkPrefer) {
          this.setLight();
        } else {
          this.setDark();
        }
      }
      this.updateMermaid();
    } /* flipMode() */
  } /* ModeToggle */
  let toggle = new ModeToggle();
  $(".mode-toggle").click(function() {
    toggle.flipMode();
  });
</script>
      </span>
 </div>
</div>
<div id="topbar-wrapper" class="row justify-content-center topbar-down">
 <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">
        <span>
          <a href="/">
            Posts
          </a>
        </span>
          <span>TF101</span>
    </span>
    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>
   <div id="topbar-title">
      Post
   </div>
    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
 </div>
</div>
   <div id="main-wrapper">
     <div id="main">
<div class="row">
 <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">
   <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
     <h1 data-toc-skip>TF101</h1>
     <div class="post-meta text-muted d-flex flex-column">
       <div>
          <span class="semi-bold">
            Bandi Jai Krishna
          </span>
<em class="timeago"
    data-ts="1620125245"
      data-toggle="tooltip" data-placement="bottom" 
      title="Tue, May  4, 2021,  4:17 PM +0530"
    >
  2021-05-04
</em>
       </div>
       <div>
          <span>
<em class="timeago lastmod"
    data-ts="1642503960"
      data-toggle="tooltip" data-placement="bottom" 
      title="Tue, Jan 18, 2022,  4:36 PM +0530"
    >
  2022-01-18
</em>
          </span>
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1838 words">10 min</span>
       </div>
     </div>
     <div class="post-content">
       <p><strong>Contents</strong>: Visulization of TF, Publishing, Broadcasting &amp; Listening to TF, Static Transform, Joint and Robot State Publishers.</p>
<hr />
<p>A transform specifies how data expressed in a frame can be transformed into a different frame. For instance, if you detect an obstacle with the laser at 3 cm in the front, this means that it is 3 cm from the laser, but not from the center of the robot (that is usually called the /base_link). To know the distance from the center of the robot, you need to transform the 3 cm from the /laser_frame to the /base_link frame (which is actually what the Path Planning system needs to know, what is the distance from the center of the robot to the obstacle).</p>
<p>First, we’ll define two frames (coordinate frames), one at the center of the laser and another one at the center of the robot. Usually, the center of the robot is placed at the rotational center of the robot. We’ll name the laser frame as base_laser and the robot frame as base_link.</p>
<p>Now, we need to define a relationship (in terms of position and orientation) between the base_laser and the base_link. For instance, we know that the base_laser frame is at a distance of 20 cm in the y axis and 10 cm in the x axis referring the base_link frame. Then we’ll have to provide this relationship to the robot. This relationship between the position of the laser and the base of the robot is known in ROS as the TRANSFORM between the laser and the robot.</p>
<h2 id="visulization-of-tf">Visulization of TF</h2>
<h3 id="view_frames">View_frames</h3>
<p>The view_frames ROS node generates a diagram with the current TF tree of the system.</p>
<p><code class="language-plaintext highlighter-rouge">rosrun tf view_frames</code></p>
<h3 id="rqt_tf_tree">rqt_tf_tree</h3>
<p>rqt_tf_tree gives the same functionality as the view_frames, with an interesting extra: you can refresh and see changes without having to generate another PDF file each time.</p>
<p><code class="language-plaintext highlighter-rouge">rosrun rqt_tf_tree rqt_tf_tree</code></p>
<h3 id="using-echo-tf">Using echo /tf</h3>
<p>There is a topic named /tf where all the TFs are published. The only problem is that ALL of them are published. In simple systems like this one, that isn’t a problem; but in massive systems, the quantity of data can be overwhelming. Therefore, the tf package gives a handy tool that filters which transform you are interested in and just shows you that one.</p>
<p><code class="language-plaintext highlighter-rouge">rostopic echo -n1 /tf</code></p>
<h3 id="using-tf_echo">Using tf_echo</h3>
<p>The /tf topic only publishes the direct TFs, not all the transforms between all the frames. tf_echo does return the transforms between any connected frames to you.</p>
<p><code class="language-plaintext highlighter-rouge">rosrun tf tf_echo [reference_frame] [target_frame]</code></p>
<h2 id="tf-publisher-broadcaster-listener-subscriber">TF Publisher, Broadcaster, Listener, Subscriber</h2>
<h3 id="tf-publisher">TF Publisher</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python  
</span><span class="kn">import</span> <span class="n">rospy</span>
<span class="kn">import</span> <span class="n">tf2_ros</span>
<span class="kn">from</span> <span class="n">tf2_msgs.msg</span> <span class="kn">import</span> <span class="n">TFMessage</span>
<span class="kn">from</span> <span class="n">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">TransformStamped</span>


<span class="n">rospy</span><span class="p">.</span><span class="nf">init_node</span><span class="p">(</span><span class="sh">'</span><span class="s">fixed_tf2_broadcaster</span><span class="sh">'</span><span class="p">)</span>

<span class="n">pub_tf</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Publisher</span><span class="p">(</span><span class="sh">"</span><span class="s">/tf</span><span class="sh">"</span><span class="p">,</span><span class="n">TFMessage</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">message</span> <span class="o">=</span> <span class="nc">TFMessage</span><span class="p">()</span>

<span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="p">.</span><span class="nf">is_shutdown</span><span class="p">():</span>
     <span class="c1"># Run this loop at about 10Hz
</span>    <span class="n">rospy</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="n">t1</span> <span class="o">=</span> <span class="nc">TransformStamped</span><span class="p">()</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="sh">"</span><span class="s">turtle1</span><span class="sh">"</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">child_frame_id</span> <span class="o">=</span> <span class="sh">"</span><span class="s">carrot1</span><span class="sh">"</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">translation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">translation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">translation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="n">t1</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">w</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="n">t2</span> <span class="o">=</span> <span class="nc">TransformStamped</span><span class="p">()</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="sh">"</span><span class="s">turtle1</span><span class="sh">"</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">child_frame_id</span> <span class="o">=</span> <span class="sh">"</span><span class="s">carrot2</span><span class="sh">"</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">translation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">translation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">4.0</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">translation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="n">t2</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">w</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="n">message</span> <span class="o">=</span> <span class="p">[</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">]</span>
    <span class="n">pub_tf</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

<span class="n">rospy</span><span class="p">.</span><span class="nf">spin</span><span class="p">()</span>
</pre></table></code></div></div>
<h3 id="tf-broadcaster-example---1">TF Broadcaster Example - 1</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">handle_turtle_pose</span><span class="p">(</span><span class="n">pose_msg</span><span class="p">,</span> <span class="n">robot_name</span><span class="p">):</span>
    <span class="n">br</span> <span class="o">=</span> <span class="n">tf2_ros</span><span class="p">.</span><span class="nc">TransformBroadcaster</span><span class="p">()</span>

    <span class="n">br</span><span class="p">.</span><span class="nf">sendTransform</span><span class="p">((</span><span class="n">pose_msg</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">pose_msg</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">pose_msg</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span><span class="p">),</span>
                     <span class="p">(</span><span class="n">pose_msg</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">pose_msg</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">pose_msg</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="n">pose_msg</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">w</span><span class="p">),</span>
                     <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">(),</span>
                     <span class="n">robot_name</span><span class="p">,</span>
                     <span class="sh">"</span><span class="s">/world</span><span class="sh">"</span><span class="p">)</span>
</pre></table></code></div></div>
<p>You have to publish each element of the position and orientation inside a parenthesis, otherwise it might not work.There is also a very important element, which is the rospy.Time.now(). This is because TF really depends on time to make everything work and be able to play with past messages. Then, state the name of the child-frame you want to assign that model (robot_name) and the parent-frame, which, in this case, is /world.</p>
<h3 id="tf-broadcaster-example---2">TF Broadcaster Example - 2</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python  
</span><span class="kn">import</span> <span class="n">rospy</span>
<span class="kn">import</span> <span class="n">tf</span>
<span class="kn">import</span> <span class="n">math</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="n">rospy</span><span class="p">.</span><span class="nf">init_node</span><span class="p">(</span><span class="sh">'</span><span class="s">my_moving_carrot_tf_broadcaster</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">br</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="nc">TransformBroadcaster</span><span class="p">()</span>
    <span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Rate</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span>
    <span class="n">turning_speed_rate</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="p">.</span><span class="nf">is_shutdown</span><span class="p">():</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">to_sec</span><span class="p">()</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">turning_speed_rate</span>
        <span class="c1"># Map to only one turn maximum [0,2*pi)
</span>        <span class="n">rad_var</span> <span class="o">=</span> <span class="n">t</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="p">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">br</span><span class="p">.</span><span class="nf">sendTransform</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">rad_var</span><span class="p">),</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="n">rad_var</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                         <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">(),</span>
                         <span class="sh">"</span><span class="s">moving_carrot</span><span class="sh">"</span><span class="p">,</span>
                         <span class="sh">"</span><span class="s">turtle2</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">rate</span><span class="p">.</span><span class="nf">sleep</span><span class="p">()</span>
</pre></table></code></div></div>
<h3 id="tf-broadcaster-from-pose-for-turtlesim_node">TF Broadcaster from Pose for turtlesim_node</h3>
<p><strong>NOTE: Requires setting of ROS params in launch file as shown below</strong></p>
<div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nt">&lt;launch&gt;</span>
    <span class="c">&lt;!--To get the Pose from turtle bot we have to launch turtlesim_node--&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">pkg=</span><span class="s">"turtlesim"</span> <span class="na">type=</span><span class="s">"turtlesim_node"</span> <span class="na">name=</span><span class="s">"sim"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"turtle1_tf2_broadcaster"</span> <span class="na">pkg=</span><span class="s">"learning_tf2"</span> <span class="na">type=</span><span class="s">"turtle_tf2_broadcaster.py"</span> <span class="na">respawn=</span><span class="s">"false"</span> <span class="na">output=</span><span class="s">"screen"</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"turtle"</span> <span class="na">type=</span><span class="s">"string"</span> <span class="na">value=</span><span class="s">"turtle1"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;/node&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></table></code></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="c1">#! /usr/bin/env python
</span>
<span class="kn">import</span> <span class="n">rospy</span>
<span class="kn">from</span> <span class="n">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">TransformStamped</span>
<span class="kn">from</span> <span class="n">turtlesim.msg</span> <span class="kn">import</span> <span class="n">Pose</span>
<span class="kn">import</span> <span class="n">tf_conversions</span>
<span class="kn">import</span> <span class="n">tf2_ros</span>

<span class="k">def</span> <span class="nf">callback_function</span><span class="p">(</span><span class="n">pose</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">turtlename</span>
    <span class="n">br</span> <span class="o">=</span> <span class="n">tf2_ros</span><span class="p">.</span><span class="nc">TransformBroadcaster</span><span class="p">()</span>
    <span class="n">t</span> <span class="o">=</span> <span class="nc">TransformStamped</span><span class="p">()</span>

    <span class="n">t</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
    <span class="n">t</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="sh">'</span><span class="s">world</span><span class="sh">'</span>
    <span class="n">t</span><span class="p">.</span><span class="n">child_frame_id</span> <span class="o">=</span> <span class="n">turtlename</span>
    <span class="n">t</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">translation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pose</span><span class="p">.</span><span class="n">x</span>
    <span class="n">t</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">translation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pose</span><span class="p">.</span><span class="n">y</span>
    <span class="n">t</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">translation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">tf_conversions</span><span class="p">.</span><span class="n">transformations</span><span class="p">.</span><span class="nf">quaternion_from_euler</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">pose</span><span class="p">.</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">t</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">t</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">t</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">t</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">br</span><span class="p">.</span><span class="nf">sendTransform</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="n">rospy</span><span class="p">.</span><span class="nf">init_node</span><span class="p">(</span><span class="sh">'</span><span class="s">tf2_broadcaster</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">turtlename</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nf">get_param</span><span class="p">(</span><span class="sh">'</span><span class="s">~turtle</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">rospy</span><span class="p">.</span><span class="nc">Subscriber</span><span class="p">(</span><span class="sh">'</span><span class="s">/%s/pose</span><span class="sh">'</span><span class="o">%</span> <span class="n">turtlename</span><span class="p">,</span><span class="n">Pose</span><span class="p">,</span><span class="n">callback_function</span><span class="p">)</span>

    <span class="n">rospy</span><span class="p">.</span><span class="nf">spin</span><span class="p">()</span>
</pre></table></code></div></div>
<h3 id="tf-listener">TF Listener</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python  
</span>
<span class="kn">import</span> <span class="n">rospy</span>
<span class="kn">import</span> <span class="n">tf</span>
<span class="kn">import</span> <span class="n">math</span>
<span class="kn">import</span> <span class="n">tf2_ros</span>
<span class="kn">from</span> <span class="n">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">Twist</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="n">rospy</span><span class="p">.</span><span class="nf">init_node</span><span class="p">(</span><span class="sh">'</span><span class="s">tf2_turtle_listener</span><span class="sh">'</span><span class="p">)</span>

    <span class="n">tfBuffer</span> <span class="o">=</span> <span class="n">tf2_ros</span><span class="p">.</span><span class="nc">Buffer</span><span class="p">()</span>
    <span class="n">tf2_ros</span><span class="p">.</span><span class="nc">TransformListener</span><span class="p">(</span><span class="n">tfBuffer</span><span class="p">)</span>

    <span class="n">turtle_name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">turtle2</span><span class="sh">"</span>

    <span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Rate</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="p">.</span><span class="nf">is_shutdown</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="n">tfBuffer</span><span class="p">.</span><span class="nf">lookup_transform</span><span class="p">(</span><span class="n">turtle_name</span><span class="p">,</span> <span class="sh">'</span><span class="s">turtle1</span><span class="sh">'</span><span class="p">,</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Time</span><span class="p">())</span>
            <span class="c1">#print(trans)
</span>        <span class="nf">except </span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">LookupException</span><span class="p">,</span> <span class="n">tf</span><span class="p">.</span><span class="n">ConnectivityException</span><span class="p">,</span> <span class="n">tf</span><span class="p">.</span><span class="n">ExtrapolationException</span><span class="p">):</span>
            <span class="n">rate</span><span class="p">.</span><span class="nf">sleep</span><span class="p">()</span>
            <span class="k">continue</span>

        <span class="nf">print</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span>
        <span class="n">rate</span><span class="p">.</span><span class="nf">sleep</span><span class="p">()</span>
</pre></table></code></div></div>
<p><strong>NOTE: Using <code class="language-plaintext highlighter-rouge">rospy.Time.now()</code> in lookup_transform can cause errors. <code class="language-plaintext highlighter-rouge">rospy.Time.now()</code> &gt; will ask for the frame with the current time, which might always not be avaiable immdeaditly. <code class="language-plaintext highlighter-rouge">rospy.Time()</code> &gt; will ask for the latest frame that is available. To tackle this a time out argument can be given to the lookup_transform,</strong></p>
<p><code class="language-plaintext highlighter-rouge">trans = tfBuffer.lookup_transform(turtle_name, 'turtle1', rospy.Time.now(),rospy.Duration(1.0))</code></p>
<h2 id="time-travel">Time Travel</h2>
<p>To get the tranform between two objects from the past the following can be used.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">try</span><span class="p">:</span>
    <span class="n">past</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Duration</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span>
    <span class="n">trans</span> <span class="o">=</span> <span class="n">tfBuffer</span><span class="p">.</span><span class="nf">lookup_transform</span><span class="p">(</span><span class="n">turtle_name</span><span class="p">,</span> <span class="sh">'</span><span class="s">carrot1</span><span class="sh">'</span><span class="p">,</span> <span class="n">past</span><span class="p">,</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Duration</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))</span>
<span class="nf">except </span><span class="p">(</span><span class="n">tf2_ros</span><span class="p">.</span><span class="n">LookupException</span><span class="p">,</span> <span class="n">tf2_ros</span><span class="p">.</span><span class="n">ConnectivityException</span><span class="p">,</span> <span class="n">tf2_ros</span><span class="p">.</span><span class="n">ExtrapolationException</span><span class="p">):</span>
</pre></table></code></div></div>
<p>To get transforms between objects from different timelines the following can be used.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">try</span><span class="p">:</span>
    <span class="n">past</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">rospy</span><span class="p">.</span><span class="nc">Duration</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span>
    <span class="n">trans</span> <span class="o">=</span> <span class="n">tfBuffer</span><span class="p">.</span><span class="nf">lookup_transform_full</span><span class="p">(</span><span class="n">target_frame</span><span class="o">=</span><span class="n">turtle_name</span><span class="p">,</span><span class="n">target_time</span><span class="o">=</span><span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">(),</span> <span class="n">source_frame</span><span class="o">=</span><span class="sh">'</span><span class="s">carrot1</span><span class="sh">'</span><span class="p">,</span><span class="n">source_time</span><span class="o">=</span><span class="n">past</span><span class="p">,</span><span class="n">fixed_frame</span><span class="o">=</span><span class="sh">'</span><span class="s">world</span><span class="sh">'</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="n">rospy</span><span class="p">.</span><span class="nc">Duration</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))</span>

<span class="nf">except</span><span class="p">(</span><span class="n">tf2_ros</span><span class="p">.</span><span class="n">LookupException</span><span class="p">,</span> <span class="n">tf2_ros</span><span class="p">.</span><span class="n">ConnectivityException</span><span class="p">,</span> <span class="n">tf2_ros</span><span class="p">.</span><span class="n">ExtrapolationException</span><span class="p">):</span>
</pre></table></code></div></div>
<h2 id="robot_state_publisher">robot_state_publisher</h2>
<p>Publishing all the TF’s manually is very tedious and hence ROS provides nice tool called robot state publisher to automate the task for you. In essence, it takes a file describing the morphology of the robot (aka URDF file) as input and it automatically publishes the TF for you.</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nt">&lt;launch&gt;</span>

  <span class="c">&lt;!-- Load the URDF file in the param server variable robot_description if it wasn't loaded before --&gt;</span>
  <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"robot_description"</span> <span class="na">command=</span><span class="s">"cat $(find pi_robot_pkg)/urdf/pi_robot_v2.urdf"</span><span class="nt">/&gt;</span>

  <span class="c">&lt;!-- Publish TF with robot_state_publisher --&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"robot_state_publisher"</span> <span class="na">pkg=</span><span class="s">"robot_state_publisher"</span> <span class="na">type=</span><span class="s">"robot_state_publisher"</span>
    <span class="na">respawn=</span><span class="s">"false"</span> <span class="na">output=</span><span class="s">"screen"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;remap</span> <span class="na">from=</span><span class="s">"/joint_states"</span> <span class="na">to=</span><span class="s">"/pi_robot/joint_states"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/node&gt;</span>

<span class="nt">&lt;/launch&gt;</span>
</pre></table></code></div></div>
<h2 id="joint_state_publisher">joint_state_publisher</h2>
<p>There are two ways to publish non-fixed joint frames</p>
<h3 id="publish-them-directly">Publish them directly</h3>
<div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nt">&lt;launch&gt;</span>
  <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"robot_description"</span> <span class="na">command=</span><span class="s">"cat $(find pi_robot_pkg)/urdf/pi_robot_v2.urdf"</span> <span class="nt">/&gt;</span>

  <span class="c">&lt;!-- send fake joint values --&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"joint_state_publisher"</span> <span class="na">pkg=</span><span class="s">"joint_state_publisher"</span> <span class="na">type=</span><span class="s">"joint_state_publisher"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"use_gui"</span> <span class="na">value=</span><span class="s">"TRUE"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/node&gt;</span>

  <span class="c">&lt;!-- Combine joint values --&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"robot_state_publisher"</span> <span class="na">pkg=</span><span class="s">"robot_state_publisher"</span> <span class="na">type=</span><span class="s">"state_publisher"</span><span class="nt">/&gt;</span>

  <span class="c">&lt;!-- Show in RVIZ   --&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"rviz"</span> <span class="na">pkg=</span><span class="s">"rviz"</span> <span class="na">type=</span><span class="s">"rviz"</span> <span class="na">args=</span><span class="s">"-d $(find pi_robot_pkg)/launch/pi_robot.rviz"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/launch&gt;</span>
</pre></table></code></div></div>
<p><strong>NOTE: This only works in RVIZ, meaning the robot in gazebo won’t be effected by the joint state values.</strong></p>
<h3 id="publish-them-through-hardwaresimulation">Publish them through Hardware/Simulation</h3>
<p><strong>Step 1: Define a joint that isn’t fixed in your URDF File</strong></p>
<div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">"left_shoulder_forward_joint"</span> <span class="na">type=</span><span class="s">"revolute"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">"left_shoulder_link"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">"left_shoulder_forward_link"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">"0 0.025 0"</span> <span class="na">rpy=</span><span class="s">"0 0 0"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;limit</span> <span class="na">lower=</span><span class="s">"-1.57"</span> <span class="na">upper=</span><span class="s">"1.57"</span> <span class="na">effort=</span><span class="s">"10"</span> <span class="na">velocity=</span><span class="s">"3"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">"0 0 1"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;dynamics</span> <span class="na">damping=</span><span class="s">"0.7"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/joint&gt;</span>
</pre></table></code></div></div>
<p><strong>Step 2: Define a Transmission for your joint in your URDF File</strong></p>
<div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nt">&lt;transmission</span> <span class="na">name=</span><span class="s">"tran4"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;type&gt;</span>transmission_interface/SimpleTransmission<span class="nt">&lt;/type&gt;</span>
    <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">"left_shoulder_forward_joint"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;hardwareInterface&gt;</span>EffortJointInterface<span class="nt">&lt;/hardwareInterface&gt;</span>
    <span class="nt">&lt;/joint&gt;</span>
    <span class="nt">&lt;actuator</span> <span class="na">name=</span><span class="s">"motor4"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;hardwareInterface&gt;</span>EffortJointInterface<span class="nt">&lt;/hardwareInterface&gt;</span>
        <span class="nt">&lt;mechanicalReduction&gt;</span>1<span class="nt">&lt;/mechanicalReduction&gt;</span>
    <span class="nt">&lt;/actuator&gt;</span>
<span class="nt">&lt;/transmission&gt;</span>
</pre></table></code></div></div>
<p><strong>Step 3: Define the new transmission controller with the name xxx_position_controller (left_shoulder_forward_joint_position_controller) in a configuration yaml file</strong></p>
<div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="na">pi_robot</span><span class="pi">:</span>
  <span class="c1"># Publish all joint states -----------------------------------</span>
  <span class="na">joint_state_controller</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">joint_state_controller/JointStateController</span>
    <span class="na">publish_rate</span><span class="pi">:</span> <span class="m">50</span>

  <span class="na">left_shoulder_forward_joint_position_controller</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">effort_controllers/JointPositionController</span>
    <span class="na">joint</span><span class="pi">:</span> <span class="s">left_shoulder_forward_joint</span>
    <span class="na">pid</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">p</span><span class="pi">:</span> <span class="nv">100.0</span><span class="pi">,</span> <span class="nv">i</span><span class="pi">:</span> <span class="nv">0.01</span><span class="pi">,</span> <span class="nv">d</span><span class="pi">:</span> <span class="nv">10.0</span><span class="pi">}</span>
</pre></table></code></div></div>
<p><strong>Step 4: Start everything through a launch file.</strong></p>
<div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="nt">&lt;launch&gt;</span>

  <span class="c">&lt;!-- Load the URDF file in the param server variable robot_description if it wasn't loaded before --&gt;</span>
  <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"robot_description"</span> <span class="na">command=</span><span class="s">"cat $(find pi_robot_pkg)/urdf/pi_robot_v2.urdf"</span> <span class="nt">/&gt;</span>
<span class="c">&lt;!-- Load joint controller configurations from YAML file to parameter server --&gt;</span>
  <span class="nt">&lt;rosparam</span> <span class="na">file=</span><span class="s">"$(find pi_robot_pkg)/config/pirobot_control.yaml"</span> <span class="na">command=</span><span class="s">"load"</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"controller_spawner"</span>
        <span class="na">pkg=</span><span class="s">"controller_manager"</span>
        <span class="na">type=</span><span class="s">"spawner"</span>
        <span class="na">respawn=</span><span class="s">"false"</span>
        <span class="na">output=</span><span class="s">"screen"</span>
        <span class="na">ns=</span><span class="s">"/pi_robot"</span>
        <span class="na">args=</span><span class="s">"head_pan_joint_position_controller
              head_tilt_joint_position_controller
              torso_joint_position_controller
              left_shoulder_forward_joint_position_controller
              right_shoulder_forward_joint_position_controller
              left_shoulder_up_joint_position_controller
              right_shoulder_up_joint_position_controller
              left_elbow_joint_position_controller
              right_elbow_joint_position_controller
              left_wrist_joint_position_controller
              right_wrist_joint_position_controller
              joint_state_controller"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"robot_state_publisher"</span> <span class="na">pkg=</span><span class="s">"robot_state_publisher"</span> <span class="na">type=</span><span class="s">"robot_state_publisher"</span>
    <span class="na">respawn=</span><span class="s">"false"</span> <span class="na">output=</span><span class="s">"screen"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;remap</span> <span class="na">from=</span><span class="s">"/joint_states"</span> <span class="na">to=</span><span class="s">"/pi_robot/joint_states"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/node&gt;</span> 

<span class="c">&lt;!-- &lt;node name="robot_state_publisher" pkg="robot_state_publisher" type="state_publisher"/&gt;--&gt;</span>


<span class="nt">&lt;/launch&gt;</span>
</pre></table></code></div></div>
<h2 id="static-transforms">Static Transforms</h2>
<p>There are some cases where changing the URDF is not advisable or it simply makes no sense to add it to the robot model.urdf. These are the cases where publishing a static transform, especially through the launch file or commands, is more convenient.</p>
<h3 id="through-command-line">Through Command Line</h3>
<p>The following syntax can be used to publish a static transform via command line. <code class="language-plaintext highlighter-rouge">rosrun tf static_transform_publisher x y z yaw pitch roll frame_id child_frame_id period_in_ms</code></p>
<h3 id="through-launch-files">Through Launch files</h3>
<p>The following syntax can be used to publish a static transform via launch files.</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nt">&lt;launch&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">pkg=</span><span class="s">"tf"</span> <span class="na">type=</span><span class="s">"static_transform_publisher"</span> <span class="na">name=</span><span class="s">"name_of_node"</span> 
          <span class="na">args=</span><span class="s">"x y z yaw pitch roll frame_id child_frame_id period_in_ms"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/node&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></table></code></div></div>
<h2 id="extra-content">Extra Content</h2>
<h3 id="spawn-a-urdf-model-in-gazebo">Spawn a URDF Model in gazebo</h3>
<p>This is an example of a launch file you could use to spawn URDF models into a Gazebo world:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>

<span class="nt">&lt;launch&gt;</span>

    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">"x"</span> <span class="na">default=</span><span class="s">"0.0"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">"y"</span> <span class="na">default=</span><span class="s">"0.0"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">"z"</span> <span class="na">default=</span><span class="s">"0.0"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">"urdf_robot_file"</span> <span class="na">default=</span><span class="s">"$(find your_pkg)/urdf/your_robot.urdf"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">"robot_name"</span> <span class="na">default=</span><span class="s">"your_robot_model_name"</span> <span class="nt">/&gt;</span>


    <span class="c">&lt;!-- Load the URDF into the ROS Parameter Server --&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"robot_description"</span> <span class="na">command=</span><span class="s">"cat $(arg urdf_robot_file)"</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Run a python script to the send a service call to gazebo_ros to spawn a URDF robot --&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"urdf_spawner"</span> <span class="na">pkg=</span><span class="s">"gazebo_ros"</span> <span class="na">type=</span><span class="s">"spawn_model"</span> <span class="na">respawn=</span><span class="s">"false"</span> <span class="na">output=</span><span class="s">"screen"</span>
    <span class="na">args=</span><span class="s">"-urdf -x $(arg x) -y $(arg y) -z $(arg z)  -model $(arg robot_name) -param robot_description"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></table></code></div></div>
<h3 id="delete-a-model-from-gazebo">Delete a model from gazebo</h3>
<p><strong>To get a list of all the current models in gazebo:</strong></p>
<p><code class="language-plaintext highlighter-rouge">osservice call /gazebo/get_world_properties "{}"</code></p>
<p><strong>To delete a paticular model from the above list:</strong></p>
<p><code class="language-plaintext highlighter-rouge">rosservice call /gazebo/delete_model "model_name: 'your_robot_model_name'"</code></p>
     </div>
     <div class="post-tail-wrapper text-muted">
       <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
            <a href='/categories/resources/'>Resources</a>,
            <a href='/categories/roscheatsheet/'>ROSCheatSheet</a>
       </div>
       <div class="post-tags">
          <i class="fa fa-tags fa-fw mr-1"></i>
          <a href="/tags/ros/"
            class="post-tag no-text-decoration" >ros</a>
          <a href="/tags/tf/"
            class="post-tag no-text-decoration" >tf</a>
         </div>
       <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
         <div class="license-wrapper">
            This post is licensed under
            <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
            by the author.
         </div>
<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
        <a href="https://twitter.com/intent/tweet?text=TF101 - Jai Krishna&url=https://textzip.github.io/posts/ROS-TF101/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
        <a href="https://www.facebook.com/sharer/sharer.php?title=TF101 - Jai Krishna&u=https://textzip.github.io/posts/ROS-TF101/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
        <a href="https://telegram.me/share?text=TF101 - Jai Krishna&url=https://textzip.github.io/posts/ROS-TF101/" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    <i class="fa-fw fas fa-link small" onclick="copyLink()"
        data-toggle="tooltip" data-placement="top" title="Copy link"></i>
  </span>
</div>
       </div>
     </div>
   </div>
 </div>
<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">
 <div class="access">
   <div id="access-lastmod" class="post">
      <span>Recent Update</span>
     <ul class="post-content pl-0 pb-1 ml-1 mt-2">
       <li><a href="/posts/Loco-DRL/">Proprioceptive Locomotion in Unstructured Environments</a>
       <li><a href="/posts/FTG-DRL/">Policy Modulated Trajectory Generation for Quadrupeds</a>
       <li><a href="/posts/NST-DRL/">Neural Style Transfer for Locomotion</a>
       <li><a href="/posts/LIDAR-DRL/">Locomotion with Weighted Belief in Exteroception</a>
       <li><a href="/posts/BiMan-DRL/">Bi-Manual Loco-Manipulation in Quadrupeds for Opening Doors</a>
     </ul>
   </div>
   <div id="access-tags">
      <span>Trending Tags</span>
     <div class="d-flex flex-wrap mt-3 mb-1 mr-3">
        <a class="post-tag" href="/tags/atmega328p/">atmega328p</a>
        <a class="post-tag" href="/tags/imu/">imu</a>
        <a class="post-tag" href="/tags/game/">game</a>
        <a class="post-tag" href="/tags/reinforcement-learning/">reinforcement learning</a>
        <a class="post-tag" href="/tags/bellman/">bellman</a>
        <a class="post-tag" href="/tags/mdp/">mdp</a>
        <a class="post-tag" href="/tags/optimal-value/">optimal value</a>
        <a class="post-tag" href="/tags/touch/">touch</a>
        <a class="post-tag" href="/tags/quadruped/">quadruped</a>
        <a class="post-tag" href="/tags/ros/">ros</a>
     </div>
   </div>
 </div>
    <script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>
   <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
      <span class="pl-3 pt-2 mb-2">Contents</span>
     <nav id="toc" data-toggle="toc"></nav>
   </div>
</div>
</div>
<div class="row">
 <div class="col-12 col-lg-11 col-xl-8">
   <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
 <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
   <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
   <div class="card-deck mb-4">
     <div class="card">
        <a href="/posts/ROS-Baiscs/">
         <div class="card-body">
<em class="timeago small"
    data-ts="1620125245"
    >
  2021-05-04
</em>
           <h3 class="pt-0 mt-1 mb-3" data-toc-skip>ROS Basics</h3>
           <div class="text-muted small">
             <p>
                Packages
ROS uses packages to orgnaize its program, you can think of a package as all the files that a specific ROS program needs to run sucessfully. 
A few common items inside a package:
  launc...
             </p>
           </div>
         </div>
        </a>
     </div>
     <div class="card">
        <a href="/posts/Underwater-Rover/">
         <div class="card-body">
<em class="timeago small"
    data-ts="1576417400"
    >
  2019-12-15
</em>
           <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Underwater Rover</h3>
           <div class="text-muted small">
             <p>
The primary objective of this project was to build an underwater rover platform that can be used to experiment with topics ranging from control systems and computer vision to embedded systems and...
             </p>
           </div>
         </div>
        </a>
     </div>
     <div class="card">
        <a href="/posts/Stair-Climbing/">
         <div class="card-body">
<em class="timeago small"
    data-ts="1600184120"
    >
  2020-09-15
</em>
           <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Autonomous Stair Climbing Robot</h3>
           <div class="text-muted small">
             <p>
The aim of this project is to “Design, Develop and Implement an Autonomous Stair Climbing Robot which can climb stairs, turn at the quarter-landings and deliver packages autonomously”.
Team
  ...
             </p>
           </div>
         </div>
        </a>
     </div>
   </div>
 </div>
<div class="post-navigation d-flex justify-content-between">
  <a href="/posts/ROS-Baiscs/" class="btn btn-outline-primary"
    prompt="Older">
   <p>ROS Basics</p>
  </a>
  <a href="/posts/Manipulator-Workspace-Plotter/" class="btn btn-outline-primary"
    prompt="Newer">
   <p>Manipulator Workspace Plotter</p>
  </a>
</div>
    <script src="https://utteranc.es/client.js"
        repo="TextZip/textzip.github.io"
        issue-term="title"
        theme="dark-blue"
        crossorigin="anonymous"
        async>
    </script>
   </div>
 </div>
</div>
<footer class="d-flex w-100 justify-content-center">
 <div class="d-flex justify-content-between align-items-center">
   <div class="footer-left">
     <p class="mb-0">
        © 2025
        <a href="https://github.com/TextZip">Bandi Jai Krishna</a>.
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
     </p>
   </div>
   <div class="footer-right">
     <p class="mb-0">
        Powered by
        <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
        with
        <a href="https://github.com/cotes2020/jekyll-theme-chirpy"
          target="_blank" rel="noopener">Chirpy</a>
        theme.
     </p>
   </div>
 </div>
</footer>
     </div>
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
 <div class="col-12 col-sm-11 post-content">
   <div id="search-hints">
     <h4 class="text-muted mb-4">Trending Tags</h4>
        <a class="post-tag" href="/tags/atmega328p/">atmega328p</a>
        <a class="post-tag" href="/tags/imu/">imu</a>
        <a class="post-tag" href="/tags/game/">game</a>
        <a class="post-tag" href="/tags/reinforcement-learning/">reinforcement learning</a>
        <a class="post-tag" href="/tags/bellman/">bellman</a>
        <a class="post-tag" href="/tags/mdp/">mdp</a>
        <a class="post-tag" href="/tags/optimal-value/">optimal value</a>
        <a class="post-tag" href="/tags/touch/">touch</a>
        <a class="post-tag" href="/tags/quadruped/">quadruped</a>
        <a class="post-tag" href="/tags/ros/">ros</a>
   </div>
   <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
 </div>
</div>
   </div>
   <div id="mask"></div>
    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>
<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script>
<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="https://textzip.github.io{url}">{title}</a> <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags} </div><p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }
    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>
  
