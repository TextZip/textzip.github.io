<!DOCTYPE html>
<html lang="en-US" 
>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Hands On with AVR - 03 Timers" />
<meta name="author" content="Jai Krishna" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The ATmega328p has two 8 bit timers and one 16 bit timer. Each timer has multiple modes of working. We will be covering all the timers together in the tutorial, one mode at a time." />
<meta property="og:description" content="The ATmega328p has two 8 bit timers and one 16 bit timer. Each timer has multiple modes of working. We will be covering all the timers together in the tutorial, one mode at a time." />
<link rel="canonical" href="https://textzip.github.io/posts/AVR-Diaries-03-Timers/" />
<meta property="og:url" content="https://textzip.github.io/posts/AVR-Diaries-03-Timers/" />
<meta property="og:site_name" content="Jai Krishna" />
<meta property="og:image" content="https://textzip.github.io/assets/img/PortManipulation/arduino_label.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-04T20:48:20+05:30" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://textzip.github.io/assets/img/PortManipulation/arduino_label.png" />
<meta property="twitter:title" content="Hands On with AVR - 03 Timers" />
<meta name="twitter:site" content="@twitter_username" />
<meta name="twitter:creator" content="@Jai Krishna" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jai Krishna"},"dateModified":"2022-01-18T20:14:23+05:30","datePublished":"2020-05-04T20:48:20+05:30","description":"The ATmega328p has two 8 bit timers and one 16 bit timer. Each timer has multiple modes of working. We will be covering all the timers together in the tutorial, one mode at a time.","headline":"Hands On with AVR - 03 Timers","image":"https://textzip.github.io/assets/img/PortManipulation/arduino_label.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://textzip.github.io/posts/AVR-Diaries-03-Timers/"},"url":"https://textzip.github.io/posts/AVR-Diaries-03-Timers/"}</script>
 <title>Hands On with AVR - 03 Timers | Jai Krishna
 </title>
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Jai Krishna">
<meta name="application-name" content="Jai Krishna">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<link rel="stylesheet" href="/assets/css/slider/ideal-image-slider.css">
<link rel="stylesheet" href="/assets/css/slider/themes/default.css">
  <script src="/assets/js/slider/ideal-image-slider.min.js"></script>
  <script src="/assets/js/slider/iis-bullet-nav.js"></script>
  <script src="/assets/js/slider/iis-captions.js"></script>
  <script>
  var timers = new IdealImageSlider.Slider({
      selector: '#timers',
      height: 500,
      interval: 4000,
      effect: 'slide',
      keyboardNav: true,
      });
    timers.addCaptions();
    timers.start();
  </script>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
<link rel="dns-prefetch" href="https://fonts.gstatic.com">
  <link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials">
  <link rel="dns-prefetch" href="https://www.google-analytics.com">
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script defer
    src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>
  <script async
    src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script>
<script defer src="/assets/js/dist/post.min.js"></script>
  <script defer src="/app.js"></script>
<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=G-KGYYX7MFB2"
></script>
<script>
  /* global dataLayer */
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());
  gtag("config", "G-KGYYX7MFB2");
</script>
 <body data-spy="scroll" data-target="#toc">
<div id="sidebar" class="d-flex flex-column align-items-end">
 <div class="profile-wrapper text-center">
   <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        <img src="/assets/img/profile.jpg" alt="avatar" onerror="this.style.display='none'">
      </a>
   </div>
   <div class="site-title mt-3">
      <a href="/">Jai Krishna</a>
   </div>
   <div class="site-subtitle font-italic">Robotics | Electronics | Design</div>
 </div>
 <ul class="w-100">
   <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
   <li class="nav-item">
      <a href="/projects/" class="nav-link">
        <i class="fa-fw fas fa-microchip ml-xl-3 mr-xl-3 unloaded"></i>
        <span>PROJECTS</span>
      </a>
   <li class="nav-item">
      <a href="/resources/" class="nav-link">
        <i class="fa-fw fas fa-chalkboard-teacher ml-xl-3 mr-xl-3 unloaded"></i>
        <span>RESOURCES</span>
      </a>
   <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        <span>CATEGORIES</span>
      </a>
   <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ARCHIVES</span>
      </a>
   <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ABOUT | CONTACT</span>
      </a>
   <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-chalkboard-teacher ml-xl-3 mr-xl-3 unloaded"></i>
        <span>TAGS</span>
      </a>
 </ul>
 <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center">
      <a href="https://github.com/TextZip" aria-label="github"
        class="order-3"
        target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      <a href="
          javascript:location.href = 'mailto:' + ['textzip','gmail.com'].join('@')" aria-label="email"
        class="order-4"
        >
        <i class="fas fa-envelope"></i>
      </a>
      <a href="https://www.linkedin.com/in/jai-krishna-bandi" aria-label="linkedin"
        class="order-5"
        target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
        <span class="icon-border order-2"></span>
      <span id="mode-toggle-wrapper" class="order-1">
<i class="mode-toggle fas fa-adjust"></i>
<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }
    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }
      var self = this;
      /* always follow the system prefers */
      this.sysDarkPrefers.addListener(function() {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }
          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }
          self.clearMode();
        }
        self.updateMermaid();
      });
    } /* constructor() */
    setDark() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }
    setLight() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }
    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_KEY);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }
    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }
    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }
    get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; }
    get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; }
    get hasMode() { return this.mode != null; }
    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }
    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer) ) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }
    updateMermaid() {
      if (typeof mermaid !== "undefined") {
        let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default");
        let config = { theme: expectedTheme };
        /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */
        $(".mermaid").each(function() {
          let svgCode = $(this).prev().children().html();
          $(this).removeAttr("data-processed");
          $(this).html(svgCode);
        });
        mermaid.initialize(config);
        mermaid.init(undefined, ".mermaid");
      }
    }
    flipMode() {
      if (this.hasMode) {
        if (this.isSysDarkPrefer) {
          if (this.isLightMode) {
            this.clearMode();
          } else {
            this.setLight();
          }
        } else {
          if (this.isDarkMode) {
            this.clearMode();
          } else {
            this.setDark();
          }
        }
      } else {
        if (this.isSysDarkPrefer) {
          this.setLight();
        } else {
          this.setDark();
        }
      }
      this.updateMermaid();
    } /* flipMode() */
  } /* ModeToggle */
  let toggle = new ModeToggle();
  $(".mode-toggle").click(function() {
    toggle.flipMode();
  });
</script>
      </span>
 </div>
</div>
<div id="topbar-wrapper" class="row justify-content-center topbar-down">
 <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">
        <span>
          <a href="/">
            Posts
          </a>
        </span>
          <span>Hands On with AVR - 03 Timers</span>
    </span>
    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>
   <div id="topbar-title">
      Post
   </div>
    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
 </div>
</div>
   <div id="main-wrapper">
     <div id="main">
<div class="row">
 <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">
   <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
     <h1 data-toc-skip>Hands On with AVR - 03 Timers</h1>
     <div class="post-meta text-muted d-flex flex-column">
       <div>
          <span class="semi-bold">
            Bandi Jai Krishna
          </span>
<em class="timeago"
    data-ts="1588605500"
      data-toggle="tooltip" data-placement="bottom" 
      title="Mon, May  4, 2020,  8:48 PM +0530"
    >
  2020-05-04
</em>
       </div>
       <div>
          <span>
<em class="timeago lastmod"
    data-ts="1642517063"
      data-toggle="tooltip" data-placement="bottom" 
      title="Tue, Jan 18, 2022,  8:14 PM +0530"
    >
  2022-01-18
</em>
          </span>
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2452 words">13 min</span>
       </div>
     </div>
     <div class="post-content">
       <p>The ATmega328p has two 8 bit timers and one 16 bit timer. Each timer has multiple modes of working. We will be covering all the timers together in the tutorial, one mode at a time.</p>
<h2 id="timers--prescalers">Timers &amp; Prescalers</h2>
<p>A timer is a specialized type of clock used to measure time intervals. It maintains the timing of an operation in sync with a system clock or an external clock. The purpose of the Prescaler is to allow the timer to be clocked at the rate a user desires.</p>
<h2 id="normal-mode--timer-02">Normal Mode – Timer 0/2</h2>
<p>The simplest mode to mess around with, the timer starts from <strong>BOTTOM (0x00)</strong> and goes all the way to the <strong>MAX/TOP</strong> <strong>(0xFF)</strong> and overflows back to the <strong>BOTTOM (0x00)</strong>. When the timer overflows it maybe programmed to generate an <strong>Timer Overflow Interrupt</strong>.</p>
<p>In normal operation the <strong>Timer/Counter Overflow Flag (TOV0)</strong> will be set in the same timer clock cycle as the <strong>TCNT0</strong> becomes zero. The <strong>TOV0 Flag</strong> in this case behaves like a ninth bit, except that it is only set, not cleared. However, combined with the <strong>timer overflow interrupt</strong> that automatically clears the <strong>TOV0 Flag</strong>, the timer resolution can be increased by software. There are no special cases to consider in the <strong>Normal mode</strong>, a new counter value can be written anytime.</p>
<p>The normal mode can be used to do tasks at regular intervals of time, logging data from sensors, monitoring the status of battery and many such activities . The time period between two interrupts in the normal mode can be set using the appropriate prescaler and load value. For the sake of this example, let us consider a situation where we are supposed to toggle <strong>D13</strong> every one second. Assuming <strong>FCPU = 16 MHz</strong>, the resolution can be calculated using:</p>
<p>Resolution = Prescaler/FCPU</p>
<p><img src="/assets/img/Timers/prescaler.png" alt="Image1" class="shadow" /></p>
<p>Using an initial load value of 6, will give us 250 counts before an overflow occurs. Therefore with a prescaler of 64 it takes 1000us for each overflow to occur. Using a software counter to keep track of overflows, we can see that 1000 overflows would take 1 second. The below example shows how to do the same through programming.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="k">volatile</span> <span class="kt">long</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 
<span class="n">ISR</span><span class="p">(</span><span class="n">TIMER2_OVF_vect</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">TCNT2</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">){</span> <span class="c1">// 1 second </span>
    <span class="n">PORTB</span> <span class="o">^=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span> <span class="c1">//toggle D13</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">count</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">setup</span><span class="p">(){</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">();</span> <span class="c1">//Disable Global Interrupts</span>
  <span class="n">TCCR2A</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//Normal Mode</span>
  <span class="n">TCCR2B</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">TIMSK2</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">TOIE2</span><span class="p">);</span> <span class="c1">//Enable overflow interrupt</span>
  <span class="n">sei</span><span class="p">();</span> <span class="c1">//Enable Global Interrupts</span>
  <span class="n">TCNT2</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span> <span class="c1">//Load value</span>
  <span class="n">TCCR2B</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">CS22</span><span class="p">);</span> <span class="c1">// Prescaler set to 64</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">loop</span><span class="p">(){</span>
<span class="p">}</span>
</pre></table></code></div></div>
<h2 id="normal-mode--timer-1">Normal Mode – Timer 1</h2>
<p>The normal mode for timer 1 is very similar to normal mode of timer 2/0, the only difference being the step count which arises due to the 8 and 16 bit values of the timers.</p>
<p>The counter simply overruns when it passes its maximum 16-bit value <strong>(MAX = 0xFFFF)</strong> and then restarts from the <strong>BOTTOM (0x0000)</strong>. In normal operation the <strong>Timer/Counter Overflow Flag (TOV1)</strong> will be set in the same timer clock cycle as the <strong>TCNT1</strong> becomes zero. The <strong>TOV1</strong> Flag in this case behaves like a 17th bit, except that it is only set, not cleared. However, combined with the <strong>timer overflow interrupt</strong> that automatically clears the <strong>TOV1</strong> Flag, the timer resolution can be increased by software. There are no special cases to consider in the Normal mode, a new counter value can be written anytime.</p>
<h2 id="ctc-mode--timer-02">CTC Mode – Timer 0/2</h2>
<p>In the normal mode we had to reset the timer after each overflow to a load value, this is a very inefficient way of generating a waveform as writing into <strong>TCNTn</strong> is an software level change which uses the CPU resources and also its a lot slower than a hardware level change.</p>
<p>Enter CTC mode, where the timer starts from the <strong>BOTTOM (0x00)</strong> and counts till it reaches the <strong>TOP</strong> which is equal to <strong>OCRnA</strong> and <strong>NOT MAX(0xFF)</strong>. The <strong>OCRnA</strong> defines the top value for the counter, hence also its resolution. This mode allows greater control of the compare match output frequency. It also simplifies the operation of counting external events. An interrupt can be generated each time the counter value reaches the <strong>TOP</strong> value by using the <strong>OCF2A</strong> Flag. If the interrupt is enabled, the interrupt handler routine can be used for updating the TOP value.</p>
<p>For generating a waveform output in CTC mode, the <strong>OCnA</strong> output can be set to toggle its logical level on each compare match by setting the <strong>COMnA</strong> bits. The <strong>OCnA</strong> value will not be visible on the port pin unless the data direction for the pin is set to output. As for the Normal mode of operation, the <strong>TOVn</strong> Flag is set in the same timer clock cycle that the counter counts
from <strong>MAX</strong> to <strong>BOTTOM(0x00)</strong>.</p>
<p>Lets take up the example from normal mode, and add a few more features to it. Lets generate three different waveforms, a 500 Hz wave by toggling the <strong>OCnA</strong> pin, another 500 Hz wave using the <strong>TIMERn_COMPA_vect</strong> and finally a 0.5 Hz wave using a software prescaler present insider the Interrupt handle like we did in the normal mode.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="k">volatile</span> <span class="kt">long</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 
<span class="n">ISR</span><span class="p">(</span><span class="n">TIMER2_COMPA_vect</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">PORTB</span> <span class="o">^=</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PORTB</span> <span class="o">^=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">count</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">();</span>
  <span class="n">TCCR2A</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">TCCR2A</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">COM2A0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">WGM21</span><span class="p">);</span> <span class="c1">//toggle OCR2A &amp; CTC Mode</span>
  <span class="n">TCCR2B</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">TCNT2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">OCR2A</span> <span class="o">=</span> <span class="mi">249</span><span class="p">;</span> <span class="c1">// Clear Compare value</span>
  <span class="n">TIMSK2</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">OCIE2A</span><span class="p">);</span> <span class="c1">//enable Output Compare Interrupt</span>
  <span class="n">sei</span><span class="p">();</span>
  <span class="n">TCCR2B</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">CS22</span><span class="p">);</span> <span class="c1">//Prescaler set to 64</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// put your main code here, to run repeatedly:</span>
 
<span class="p">}</span>
</pre></table></code></div></div>
<p><img src="/assets/img/Timers/graph1.png" alt="Image1" class="shadow" />
<em>Yellow – D13, Pink – D8, Blue – D11</em></p>
<p>Although this program does get the job done, it’s not the most efficient way to get the task done. The 500 Hz wave generated by <strong>TIMER2_COMPA_vect</strong> is a software triggered wave, meaning the CPU is involved in the process which can be a problem in CPU intensive sketches.</p>
<p>We will be writing a better version of the same code using both the output compare units instead of just <strong>OCRnA</strong>, here the <strong>OCnB</strong> pin is toggled directly through hardware which frees up the CPU.</p>
<p>Let’s generate three different waveforms, a 500 Hz wave by toggling the <strong>OCnA</strong> pin, another 500 Hz wave using the <strong>OCnB</strong> pin and finally a 0.5 Hz wave using a software prescaler present insider the Interrupt handle like we did in the normal mode. Another added feature would be the fact that <strong>OCRnB</strong> can be used to create a phase shift between the two 500 Hz waves.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="k">volatile</span> <span class="kt">long</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 
<span class="n">ISR</span><span class="p">(</span><span class="n">TIMER2_COMPA_vect</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PORTB</span> <span class="o">^=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">count</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">();</span>
  <span class="n">TCCR2A</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">TCCR2A</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">COM2A0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">COM2B0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">WGM21</span><span class="p">);</span> <span class="c1">//toggle OCR2A,OCR2B &amp; CTC Mode</span>
  <span class="n">TCCR2B</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">TCNT2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">OCR2A</span> <span class="o">=</span> <span class="mi">249</span><span class="p">;</span> <span class="c1">// Compare value</span>
  <span class="n">OCR2B</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span> <span class="c1">// Compare value</span>
  <span class="n">TIMSK2</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">OCIE2A</span><span class="p">);</span> <span class="c1">//enable Output Compare Interrupt</span>
  <span class="n">sei</span><span class="p">();</span>
  <span class="n">TCCR2B</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">CS22</span><span class="p">);</span> <span class="c1">//Prescaler set to 64</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// put your main code here, to run repeatedly:</span>
 
<span class="p">}</span>
</pre></table></code></div></div>
<div id="timers">
  <img data-src="" data-src-2x="" src="/assets/img/Timers/graph4.png" title="" alt="0 Phase Difference" />
  <img data-src="" data-src-2x="" src="/assets/img/Timers/graph3.png" title="" alt="180 Phase Difference" />
  <img data-src="" data-src-2x="" src="/assets/img/Timers/graph2.png" title="" alt="90 Phase Difference" />
 </div>
<p>The phase shift between <strong>OCnA</strong> and <strong>OCnB</strong> can be seen in the above pictures.</p>
<blockquote>
 <p>Notice that all the examples we have discussed till now in CTC mode are for 50% duty cycle.</p>
</blockquote>
<p>Finally before we switch to the next mode let us see how we can generate a 50 Hz PWM signal having 40% duty cycle using CTC mode.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="k">volatile</span> <span class="kt">long</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 
<span class="n">ISR</span><span class="p">(</span><span class="n">TIMER2_COMPA_vect</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">count</span><span class="o">++</span><span class="p">;</span>
  <span class="n">OCR2A</span> <span class="o">=</span> <span class="n">count</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">cli</span><span class="p">();</span>
  <span class="n">TCCR2A</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">TCCR2A</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">COM2A0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">WGM21</span><span class="p">);</span>
  <span class="n">TCCR2B</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">TCNT2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">OCR2A</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">TIMSK2</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">OCIE2A</span><span class="p">);</span>
  <span class="n">sei</span><span class="p">();</span>
  <span class="n">TCCR2B</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">CS22</span><span class="p">);</span> <span class="c1">//pre</span>
  <span class="c1">// put your setup code here, to run once:</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// put your main code here</span>
</pre></table></code></div></div>
<p><img src="/assets/img/Timers/image5.png" alt="Image1" class="shadow" />
<em>D11 – Pink</em></p>
<h2 id="force-output-compare">Force Output Compare</h2>
<p>In <strong>non-PWM Waveform Generation modes</strong>, the match output of the comparator can be forced by writing a one to the <strong>Force Output Compare (FOCnx)</strong> bit. Forcing compare match will not set the <strong>OCFnx Flag</strong> or reload/clear the timer, but the <strong>OCnx</strong> pin will be updated as if a real compare match had occurred (the <strong>COM11:0</strong> bits settings define whether the <strong>OCnx</strong> <strong>pin is set, cleared or toggled</strong>).</p>
<h2 id="input-capture-unit">Input Capture Unit</h2>
<p>The Timer/Counter incorporates an Input Capture unit that can capture external events and give them a timestamp indicating time of occurrence. The external signal indicating an event, or multiple events, can be applied via the <strong>ICP1</strong> pin or alternatively, via the analog-comparator unit. The time-stamps can then be used to calculate frequency, duty-cycle, and other features of the signal applied. Alternatively the time-stamps can be used for creating a log of the events.</p>
<p>When a change of the logic level (an event) occurs on the <strong>Input Capture pin (ICP1),</strong> alternatively on the <strong>Analog Comparator output (ACO)</strong>, and this change confirms to the setting of the edge detector, a capture will be triggered. When a capture is triggered, the 16-bit value of the counter <strong>(TCNT1)</strong> is written to the <strong>Input Capture Register (ICR1)</strong>. The <strong>Input Capture Flag (ICF1)</strong> is set at the same system clock as the <strong>TCNT1</strong> value is copied into <strong>ICR1 Register</strong>. If enabled <strong>(ICIE1 = 1)</strong>, the <strong>Input Capture Flag</strong> generates an <strong>Input Capture interrupt</strong>. The <strong>ICF1 Flag</strong> is automatically cleared when the interrupt is executed. Alternatively the <strong>ICF1 Flag</strong> can be cleared by software by writing a logical one to its I/O bit location.</p>
<p>The <strong>ICR1 Register</strong> can only be written when using a Waveform Generation mode that utilizes the <strong>ICR1</strong> Register for defining the counter’s <strong>TOP</strong> value. In these cases the <strong>Waveform Generation mode</strong> <strong>(WGM13:0)</strong> bits must be set before the <strong>TOP</strong> value can be written to the <strong>ICR1 Register</strong>. When writing the <strong>ICR1 Register</strong> the high byte must be written to the <strong>ICR1H</strong> I/O location before the low byte is written to ICR1L.</p>
<h2 id="ctc-mode--timer-1">CTC Mode – Timer 1</h2>
<p>The CTC Mode for timer 1 is similar to the CTC mode available in timer 0/2, only difference being the option to use ICR1 as the top value other than the usual option to use <strong>OCR1A</strong>.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="n">ISR</span><span class="p">(</span><span class="n">TIMER1_CAPT_vect</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">TCCR1C</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">FOC1A</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">FOC1B</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span> <span class="c1">//OC1A</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span> <span class="c1">//OC1B</span>
  <span class="n">TCCR1A</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">cli</span><span class="p">();</span>
  <span class="n">TCCR1A</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">COM1A0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">COM1B0</span><span class="p">);</span> <span class="c1">//toggle</span>
  <span class="n">TCCR1B</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">TCCR1B</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">WGM12</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">WGM13</span><span class="p">);</span> <span class="c1">// CTC+ICR</span>
  <span class="n">TIMSK1</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ICIE1</span><span class="p">);</span> <span class="c1">// Enable ICR interrupt</span>
  <span class="n">TCNT1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">ICR1</span> <span class="o">=</span> <span class="mi">2039</span><span class="p">;</span>
  <span class="n">OCR1A</span> <span class="o">=</span> <span class="mi">1223</span><span class="p">;</span> <span class="c1">//40% duty cycle</span>
  <span class="n">OCR1B</span> <span class="o">=</span> <span class="mi">815</span><span class="p">;</span> <span class="c1">//60% duty cycle 815</span>
  <span class="n">sei</span><span class="p">();</span><span class="c1">// Enable Global Interrupts</span>
  <span class="n">TCCR1B</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">CS11</span><span class="p">);</span> <span class="c1">//8 prescaler</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// put your main code here, to run repeatedly:</span>
<span class="p">}</span>
</pre></table></code></div></div>
<h2 id="fast-pwm">Fast PWM</h2>
<p>In the simplest PWM mode, The <strong>fast Pulse Width Modulation</strong> or <strong>fast PWM mode</strong> <strong>(WGM02:0 = 3 or 7)</strong> provides a high frequency PWM waveform generation option. The <strong>fast PWM</strong> differs from the other PWM option by its single-slope operation. The counter counts from <strong>BOTTOM</strong> to <strong>TOP</strong> then restarts from <strong>BOTTOM</strong>. <strong>TOP</strong> is defined as <strong>0xFF when WGM2:0 = 3</strong>, and <strong>OCR0A when WGM2:0 = 7</strong>. In <strong>non-inverting Compare Output mode</strong>, the <strong>Output Compare (OC0x)</strong> is cleared on the compare match between <strong>TCNT0</strong> and <strong>OCR0x</strong>, and set at <strong>BOTTOM</strong>. In <strong>inverting Compare Output</strong> mode, the output is set on compare match and cleared at <strong>BOTTOM</strong>.</p>
<p>The <strong>Timer/Counter Overflow Flag (TOV0)</strong> is set each time the counter reaches <strong>TOP</strong>. If the interrupt is enabled, the interrupt handler routine can be used for updating the compare value.</p>
<p>In <strong>fast PWM</strong> mode, the compare unit allows generation of PWM waveforms on the <strong>OC0x</strong> pins. Setting the <strong>COM0A1:0</strong> bits to one allows the <strong>OC0A</strong> pin to toggle on Compare Matches if the <strong>WGM02</strong> bit is set. This option is not available for the <strong>OC0B</strong> pin. The actual <strong>OC0x</strong> value will only be visible on the port pin if the data direction for the port pin is set as output. The PWM waveform is generated by setting (or clearing) the <strong>OC0x</strong> Register at the compare match between <strong>OCR0x</strong> and <strong>TCNT0</strong>, and clearing (or setting) the <strong>OC0x</strong> Register at the timer clock cycle the counter is cleared (changes from <strong>TOP</strong> to <strong>BOTTOM</strong>).</p>
<p>The PWM frequency for the output can be calculated by the following equation:</p>
<blockquote>
 <p>Frequency = fclock/(N*(TOP+1))
<strong>WHERE N IS THE PRESCALER.</strong></p>
</blockquote>
<p>Using <strong>OCRnA</strong> as the top value will give us more freedom in controlling the frequency of the output waveform, but <strong>OCRnA</strong> cannot be used both as the top value and the PWM compare value. Only <strong>OCRnB</strong> can be used to generate waveforms. However, there is a special-case mode “<strong>Toggle OCnA on Compare Match</strong>” that will toggle output A at the end of each cycle, generating a fixed 50% duty cycle and half frequency in this case.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">cli</span><span class="p">();</span>
  <span class="n">TCCR2A</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//clear the values</span>
  <span class="n">TCCR2A</span> <span class="o">|=</span> <span class="p">((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">COM2A1</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">COM2B1</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">WGM20</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">WGM21</span><span class="p">));</span> <span class="c1">// set to fast PWM with std TOP and use non-inverting mode for OCnA and OCnB</span>
  <span class="n">TCCR2B</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">OCR2A</span> <span class="o">=</span> <span class="mi">204</span><span class="p">;</span> <span class="c1">// 30% duty cycle</span>
  <span class="n">OCR2B</span> <span class="o">=</span> <span class="mi">76</span><span class="p">;</span> <span class="c1">// 80% duty cycle</span>
  <span class="n">TCCR2B</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">CS22</span><span class="p">);</span> <span class="c1">//prescaler set to 64</span>
  <span class="n">sei</span><span class="p">();</span>
  <span class="c1">// put your setup code here, to run once:</span>
 
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// put your main code here, to run repeatedly:</span>
 
<span class="p">}</span>
</pre></table></code></div></div>
<h2 id="coming-up">Coming Up</h2>
<ul class="task-list">
 <li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Phase Correct PWM
 <li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Phase and Frequency Correct PWM
</ul>
     </div>
     <div class="post-tail-wrapper text-muted">
       <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
            <a href='/categories/resources/'>Resources</a>,
            <a href='/categories/avr-dairies/'>AVR Dairies</a>
       </div>
       <div class="post-tags">
          <i class="fa fa-tags fa-fw mr-1"></i>
          <a href="/tags/atmega328p/"
            class="post-tag no-text-decoration" >atmega328p</a>
          <a href="/tags/timer/"
            class="post-tag no-text-decoration" >timer</a>
          <a href="/tags/fastpwm/"
            class="post-tag no-text-decoration" >fastPWM</a>
          <a href="/tags/normal-mode/"
            class="post-tag no-text-decoration" >normal mode</a>
          <a href="/tags/ctc-mode/"
            class="post-tag no-text-decoration" >CTC mode</a>
         </div>
       <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
         <div class="license-wrapper">
            This post is licensed under
            <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
            by the author.
         </div>
<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
        <a href="https://twitter.com/intent/tweet?text=Hands On with AVR - 03 Timers - Jai Krishna&url=https://textzip.github.io/posts/AVR-Diaries-03-Timers/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
        <a href="https://www.facebook.com/sharer/sharer.php?title=Hands On with AVR - 03 Timers - Jai Krishna&u=https://textzip.github.io/posts/AVR-Diaries-03-Timers/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
        <a href="https://telegram.me/share?text=Hands On with AVR - 03 Timers - Jai Krishna&url=https://textzip.github.io/posts/AVR-Diaries-03-Timers/" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    <i class="fa-fw fas fa-link small" onclick="copyLink()"
        data-toggle="tooltip" data-placement="top" title="Copy link"></i>
  </span>
</div>
       </div>
     </div>
   </div>
 </div>
<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">
 <div class="access">
   <div id="access-lastmod" class="post">
      <span>Recent Update</span>
     <ul class="post-content pl-0 pb-1 ml-1 mt-2">
       <li><a href="/posts/Loco-DRL/">Proprioceptive Locomotion in Unstructured Environments</a>
       <li><a href="/posts/FTG-DRL/">Policy Modulated Trajectory Generation for Quadrupeds</a>
       <li><a href="/posts/NST-DRL/">Neural Style Transfer for Locomotion</a>
       <li><a href="/posts/LIDAR-DRL/">Locomotion with Weighted Belief in Exteroception</a>
       <li><a href="/posts/BiMan-DRL/">Bi-Manual Loco-Manipulation in Quadrupeds for Opening Doors</a>
     </ul>
   </div>
   <div id="access-tags">
      <span>Trending Tags</span>
     <div class="d-flex flex-wrap mt-3 mb-1 mr-3">
        <a class="post-tag" href="/tags/atmega328p/">atmega328p</a>
        <a class="post-tag" href="/tags/imu/">imu</a>
        <a class="post-tag" href="/tags/game/">game</a>
        <a class="post-tag" href="/tags/reinforcement-learning/">reinforcement learning</a>
        <a class="post-tag" href="/tags/bellman/">bellman</a>
        <a class="post-tag" href="/tags/mdp/">mdp</a>
        <a class="post-tag" href="/tags/optimal-value/">optimal value</a>
        <a class="post-tag" href="/tags/touch/">touch</a>
        <a class="post-tag" href="/tags/quadruped/">quadruped</a>
        <a class="post-tag" href="/tags/ros/">ros</a>
     </div>
   </div>
 </div>
    <script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>
   <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
      <span class="pl-3 pt-2 mb-2">Contents</span>
     <nav id="toc" data-toggle="toc"></nav>
   </div>
</div>
</div>
<div class="row">
 <div class="col-12 col-lg-11 col-xl-8">
   <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
 <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
   <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
   <div class="card-deck mb-4">
     <div class="card">
        <a href="/posts/AVR-Diaries-01-Port-Manipulation/">
         <div class="card-body">
<em class="timeago small"
    data-ts="1588599800"
    >
  2020-05-04
</em>
           <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hands On with AVR - 01 Port Manipulation</h3>
           <div class="text-muted small">
             <p>
                Port Manipulation refers to the technique of directly working with the underlying registers of the ATmega chip(in this context) instead of relying on predefined Arduino functions. This is primarily...
             </p>
           </div>
         </div>
        </a>
     </div>
     <div class="card">
        <a href="/posts/AVR-Diaries-02-Interrupts/">
         <div class="card-body">
<em class="timeago small"
    data-ts="1589367200"
    >
  2020-05-13
</em>
           <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hands On with AVR - 02 Interrupts</h3>
           <div class="text-muted small">
             <p>
                Most processors have interrupts. Interrupts let you respond to “external/internal” events while doing something else.
This article uses concepts that have been covered in the previous post “AVR Di...
             </p>
           </div>
         </div>
        </a>
     </div>
     <div class="card">
        <a href="/posts/Gaming-Wheel/">
         <div class="card-body">
<em class="timeago small"
    data-ts="1545486200"
    >
  2018-12-22
</em>
           <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Gaming Wheel</h3>
           <div class="text-muted small">
             <p>
A cheap and affordable gaming wheel based on the Atmega-328p,
MPU6050 and capacitive touch sensors for an immersive gaming
experience.
Hardware
  Arduino Uno
  ADXL345 (or any IMU or tilt senso...
             </p>
           </div>
         </div>
        </a>
     </div>
   </div>
 </div>
<div class="post-navigation d-flex justify-content-between">
  <a href="/posts/AVR-Diaries-01-Port-Manipulation/" class="btn btn-outline-primary"
    prompt="Older">
   <p>Hands On with AVR - 01 Port Manipulation</p>
  </a>
  <a href="/posts/Robotics-Theory-2D-Robotics/" class="btn btn-outline-primary"
    prompt="Newer">
   <p>Robotics Theory - 2D Robotics</p>
  </a>
</div>
    <script src="https://utteranc.es/client.js"
        repo="TextZip/textzip.github.io"
        issue-term="title"
        theme="dark-blue"
        crossorigin="anonymous"
        async>
    </script>
   </div>
 </div>
</div>
<footer class="d-flex w-100 justify-content-center">
 <div class="d-flex justify-content-between align-items-center">
   <div class="footer-left">
     <p class="mb-0">
        © 2025
        <a href="https://github.com/TextZip">Bandi Jai Krishna</a>.
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
     </p>
   </div>
   <div class="footer-right">
     <p class="mb-0">
        Powered by
        <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
        with
        <a href="https://github.com/cotes2020/jekyll-theme-chirpy"
          target="_blank" rel="noopener">Chirpy</a>
        theme.
     </p>
   </div>
 </div>
</footer>
     </div>
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
 <div class="col-12 col-sm-11 post-content">
   <div id="search-hints">
     <h4 class="text-muted mb-4">Trending Tags</h4>
        <a class="post-tag" href="/tags/atmega328p/">atmega328p</a>
        <a class="post-tag" href="/tags/imu/">imu</a>
        <a class="post-tag" href="/tags/game/">game</a>
        <a class="post-tag" href="/tags/reinforcement-learning/">reinforcement learning</a>
        <a class="post-tag" href="/tags/bellman/">bellman</a>
        <a class="post-tag" href="/tags/mdp/">mdp</a>
        <a class="post-tag" href="/tags/optimal-value/">optimal value</a>
        <a class="post-tag" href="/tags/touch/">touch</a>
        <a class="post-tag" href="/tags/quadruped/">quadruped</a>
        <a class="post-tag" href="/tags/ros/">ros</a>
   </div>
   <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
 </div>
</div>
   </div>
   <div id="mask"></div>
    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>
<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script>
<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="https://textzip.github.io{url}">{title}</a> <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags} </div><p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }
    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>
  <script src="/assets/js/slider/ideal-image-slider.min.js"></script>
  <script src="/assets/js/slider/iis-bullet-nav.js"></script>
  <script src="/assets/js/slider/iis-captions.js"></script>
  <script>
  var timers = new IdealImageSlider.Slider({
      selector: '#timers',
      height: 500,
      interval: 4000,
      effect: 'slide',
      keyboardNav: true,
      });
    timers.addCaptions();
    timers.start();
  </script>
  
